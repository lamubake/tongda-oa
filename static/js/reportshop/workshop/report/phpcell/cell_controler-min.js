function TCRSCellControler(){}TCRSCellControler.prototype={constructor:TCRSCellControler,insert_row:function(z,i,w,x,j){var t=1;w=parseInt(w),x=parseInt(x);if($(z).attr("rowspan")!=undefined){t=parseInt($(z).attr("rowspan"))}if(j==undefined||!j){crsReport.crsCommon.add_action_maps(["app",i,w,x*t,t]);crsReport.crsChartCache.update_ref(i,w,x*t,"app",false)}else{crsReport.crsCommon.add_action_maps(["ins",i,w,x*t,t]);crsReport.crsChartCache.update_ref(i,w,x*t,"ins",false)}var e=$("#sheet"+i+" tr").last();var s=e.attr("id").replace("row","");var u=(j==undefined||!j)?w+t:w;for(var B=s;B>=u;B--){var D=parseInt(B)+parseInt(x)*t;$("#sheet"+i+" tr:eq("+B+")").attr("id","row"+D)}var v=this;for(var B=x;B>0;B--){for(var C=0;C<t;C++){var y=$("#sheet"+i+" tr:eq("+(w+C)+")");if(j==undefined||!j){var D=w+B*t+C}else{var D=u+(x-B)*t+C}$(y).children().each(function(){var b=1,c=1;if($(this).attr("rowspan")!=undefined){b=parseInt($(this).attr("rowspan"))}if($(this).attr("colspan")!=undefined){c=parseInt($(this).attr("colspan"))}if(b>1||c>1){var a=$(this).attr("class").indexOf(" ");if(a==-1){a=$(this).attr("class").length}var d=$(this).attr("class").substr(0,a);var d=parseInt(d.replace("column",""));crsReport.crsCommon.add_action_maps(["merge",i,d,D,(d+c-1),(D+b-1)])}});var A=$(y).clone(true,true).attr("id","row"+D);this.clear_tr(A);if(j==undefined||!j){$("#sheet"+i+" tr:eq("+(w+t-1+C)+")").after($(A))}else{$("#sheet"+i+" tr:eq("+w+")").before($(A));w++}}}},delete_row:function(q,j,o,p){var n=1;if($(q).attr("rowspan")!=undefined){n=parseInt($(q).attr("rowspan"))}o=parseInt(o),p=parseInt(p);for(var r=0;r<p;r++){for(var s=0;s<n;s++){var t=o+r*n+s;$("#row"+t).remove()}}var i=$("#sheet"+j+" tr").last();var m=i.attr("id").replace("row","");n=p*n;for(var r=o+n;r<=m;r++){var t=r-n;$("#row"+r).attr("id","row"+t);$("#sheet"+j+" tr:eq("+t+")").find("td").each(function(){var e=$(this).attr("func");if(false&&e!=undefined){if(e.substr(0,1)=="="){var k=e.substring(1)}var f=crsReport.crsCalculation._parseFormula(k);var d=e;for(var b=0;b<f.length;b++){var a=f[b].value;var g=f[b].stype;if(g=="Cell Reference"&&a.length>1&&a.indexOf("$")==-1){var h=cellNameToIndex(a);if(o<h.y){h.y-=parseInt(p)*n;var c=cellIndexToName(h);d=d.replace(a,c);$(this).attr("func",d)}}}}})}crsReport.crsCommon.add_action_maps(["del",j,o,p*n]);crsReport.crsChartCache.update_ref(j,o,p*n,"del",false)},insert_column:function(p,k,m,q,l){var n=1;m=parseInt(m),q=parseInt(q);if($(p).attr("colspan")!=undefined){n=parseInt($(p).attr("colspan"))}if(l==undefined||!l){crsReport.crsCommon.add_action_maps(["app",k,m+n,q*n]);crsReport.crsChartCache.update_ref(k,m,q*n,"app",true)}else{crsReport.crsCommon.add_action_maps(["ins",k,m,q*n]);crsReport.crsChartCache.update_ref(k,m,q*n,"ins",true)}var j=(l==undefined||!l)?m+n:m;var r=$("#sheet"+k+" tr:eq(0)").find("td:last").index();$("#sheet"+k+" tr").each(function(){if($(this).attr("rid")){for(var b=r;b>=j;b--){var a=parseInt(b)+parseInt(q)*n;var d=$(this).find("td:eq("+b+")");var c=d.attr("class").replace("column"+b,"column"+a);d.attr("class",c)}if(q>1){$("#sheet"+k).css("width","")}}});var o;$("#sheet"+k+" tr").each(function(){if($(this).attr("rid")){for(var g=q;g>0;g--){if(q>1){o=m+q-g}else{o=m}var e=$(this).find("td:eq("+o+")");if(l==undefined||!l){var a=o+n}else{var a=j}var f=$(e).attr("class").indexOf(" ");if(f==-1){f=$(e).attr("class").length}var b=$(e).attr("class").substr(0,f);var c=$(e).clone(false);var d=$(c).attr("class").replace(b,"column"+a);$(c).attr("class",d);$(c).text("");if($(c).attr("val")!=undefined){$(c).attr("val","")}if($(c).attr("val2")!=undefined){$(c).attr("val2","")}if($(c).attr("pval")!=undefined){$(c).attr("pval","")}if(l==undefined||!l){$(this).find("td:eq("+(o)+")").after($(c))}else{$(this).find("td:eq("+(o)+")").before($(c))}}}});$("#sheet"+k+" tr").find("td").each(function(){var f=$(this).attr("func");if(false&&f!=undefined){if(f.substr(0,1)=="="){var a=f.substring(1)}var g=crsReport.crsCalculation._parseFormula(a);var e=f;for(var c=0;c<g.length;c++){var b=g[c].value;var h=g[c].stype;if(h=="Cell Reference"&&b.length>1&&b.indexOf("$")==-1){var i=cellNameToIndex(b);if(m<=i.x){i.x+=parseInt(q)*n;var d=cellIndexToName(i);e=e.replace(b,d);$(this).attr("func",e)}}}}})},delete_column:function(m,i,j,p){var l=1;if($(m).attr("colspan")!=undefined){l=parseInt($(m).attr("colspan"))}j=parseInt(j),p=parseInt(p);var q=$("#sheet"+i+" tr").children("td:last").index();for(var n=0;n<p;n++){for(var o=0;o<l;o++){var r=j+n*l+o;$("#sheet"+i+" tr").find("td:eq("+r+")").remove()}}l=p*l;$("#sheet"+i+" tr").each(function(){for(var t=j;t<q;t++){var B=$(this).find("td:eq("+t+")");var e=B.attr("class").indexOf(" ");if(e==-1){e=B.attr("class").length}var a=B.attr("class").substr(0,e);var g=B.attr("class").replace(a,"column"+t);B.attr("class",g);var c=B.attr("func");if(false&&c!=undefined){if(c.substr(0,1)=="="){var k=c.substring(1)}var d=crsReport.crsCalculation._parseFormula(k);var b=c;for(var A=0;A<d.length;A++){var z=d[A].value;var f=d[A].stype;if(f=="Cell Reference"&&z.length>1&&z.indexOf("$")==-1){var h=cellNameToIndex(z);if(j<h.x){h.x-=parseInt(p)*l;var C=cellIndexToName(h);b=b.replace(z,C);B.attr("func",b)}}}}}});crsReport.crsCommon.add_action_maps(["del",i,j,p*l]);crsReport.crsChartCache.update_ref(i,j,p*l,"del",false)},clear_tr:function(b){$(b).children("td").each(function(){var g=$(this).children(":eq(0)");if(g.length>0){var e=g[0].tagName.toLowerCase();if(e=="img"||e=="a"){var f=crsReport.crsTableIndex.getAColSchema($(this).attr("cid"));var a=$(this).children("i").length>0?"<i align='right'>"+$(this).children("i").html()+"</i>":"";$(this).html(crsReport.crsCommon._get_editor($(this).parent().attr("rid"),f)+a)}else{$(this).children().val("")}}if($(this).attr("val")!=undefined){$(this).attr("val","")}if($(this).attr("val2")!=undefined){$(this).attr("val2","")}if($(this).attr("pval")!=undefined){$(this).attr("pval","")}})},cache_td:function(g){var f=this;var j=crsReport;if(j.obj_cell_maps.length<1){j.obj_cell_maps=null;j.obj_cell_maps={}}var h=false;var i=j.obj_cell_maps[g]==undefined;j.obj_cell_maps[g]=[];$("#sheet"+g+" td").each(function(){var a=$(this).attr("class").indexOf(" ");if(a==-1){a=$(this).attr("class").length}var c=$(this).attr("class").substr(0,a);if(i){var b=$(this).text();if(b!=""&&b.charAt(0)=="="){$(this).attr("func",b);$(this).text("");if(!h){h=true}}}j.obj_cell_maps[g][$(this).parent("tr").attr("id")+c]=this});if(!this.b_has_excel_func&&h){this.b_has_excel_func=true}},set_cell_value:function(p,l,i,m,j){var o;if(i!=undefined){var n="row"+i+"column"+l;o=crsReport.obj_cell_maps[p][n]}else{m=l;o=p;p=this.get_sheet_index_by_cell(o);var k=this.get_cell_point(o);l=k.x;i=k.y}if(j==undefined){j=format_text($(o).attr("cid"),m)}if($(o).attr("val")!=m){$(o).attr("val",m);if($(o).attr("func")==undefined){crsReport.crsCommon.add_action_maps(["set",p,l,i,m])}}},set_cell_value2:function(h,k,i,l){var n;if(i!=undefined){var m="row"+i+"column"+k;var n=crsReport.obj_cell_maps[h][m]}else{l=k;n=h;h=this.get_sheet_index_by_cell(n);var j=this.get_cell_point(n);k=j.x;i=j.y}if($(n).attr("val2")!=l){$(n).attr("val2",l);if($(n).attr("func")==undefined){crsReport.crsCommon.add_action_maps(["set",h,k,i,l])}}},get_cell:function(f,g,h){var i="row"+h+"column"+g;var j=crsReport.obj_cell_maps[f][i];return j},get_cell_point:function(h){var g=$(h).attr("class").indexOf(" ");if(g==-1){g=$(h).attr("class").length}var f=$(h).attr("class").substr(0,g);var e={x:f.replace("column",""),y:$(h).parent().attr("id").replace("row","")};return e},get_cell_rect:function(i){var h=$(i).attr("class").indexOf(" ");if(h==-1){h=$(i).attr("class").length}var g=$(i).attr("class").substr(0,h);var f={x:g.replace("column",""),y:$(i).parent().attr("id").replace("row","")};var j={x:f.x,y:f.y};if($(i).attr("rowspan")!=undefined){j.y=parseInt(j.y)+$(i).attr("rowspan")-1}if($(i).attr("colspan")!=undefined){j.x=parseInt(j.x)+$(i).attr("colspan")-1}return new Array(f,j)},get_sheet_index_by_cell:function(d){var f=$(d).parent();f=$(f).parent();f=$(f).parent();var e=$(f).attr("id");return e.replace("sheet","")},get_cell_value:function(g,h,i){var j="row"+i+"column"+h;var l=crsReport.obj_cell_maps[g][j];var k=$(l).attr("val");if(k==undefined){k=$(l).attr("val2")}return k!=undefined?k:""},get_cell_attr:function(h,i,k,j){var l="row"+k+"column"+i;var n=crsReport.obj_cell_maps[h][l];var m=$(n).attr(j);return m!=undefined?m:""},set_cell_backgroud_color:function(h,i,k,j,n){var l="row"+k+"column"+i;var m=crsReport.obj_cell_maps[h][l];if(j==undefined&&$(m).attr("prev-background-color")!=undefined){j=$(m).attr("prev-background-color")}if(j!=undefined){if(n&&$(m).attr("prev-background-color")==undefined){$(m).attr("prev-background-color",$(m).css("background-color"))}$(m).css("background-color",j)}},set_cell_pvalue:function(g,i,h,j){var k="row"+h+"column"+i;var l=crsReport.obj_cell_maps[g][k];$(l).attr("pval",j)},clear_cell:function(p,i,l){var m="row"+l+"column"+i;var n=crsReport.obj_cell_maps[p][m];$(n).attr("val2","");$(n).attr("val","");var o=crsReport.crsTableIndex.getAColSchema($(n).attr("cid"));var j=crsReport.crsTableIndex.rows[o.row_idx];if($(n).html().indexOf("</select>")!=-1){$($(n).html()).attr("selectedIndex",0)}else{if($(n).html().indexOf("green_plus.gif")!=-1){var k=$(n).children("input").width();$(n).html(crsReport.crsCommon._get_editor($(n).parent("tr").attr("rid"),o)+crsReport.crsCommon.crsTable.op);$(n).children("input").width(k)}else{$(n).html(crsReport.crsCommon._get_editor($(n).parent("tr").attr("rid"),o))}}if($(n).attr("func")==undefined){crsReport.crsCommon.add_action_maps(["set",p,i,l,""])}}};
