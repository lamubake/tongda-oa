function TCRSReportState(d,a,c,b){this.crsDataSet=d;this.i_repid=a;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_reportstate","workflow, organidlist, useridlist, writetimelist, finishtimelist, dataflow, prevwriter","repid='"+a+"' and userid='"+c+"' and writetime='"+b+"'","id")}TCRSReportState.prototype=new TCRSDataRecord();TCRSReportState.prototype.get_prev_writer=function(a){this.loadData("#tablecrs_reportstate");var b="";var c=this.search("workflow",a);if(c!=null){b=c.prevwriter}return b};TCRSReportState.prototype.get_task_state=function(c,b){this.loadData("#tablecrs_reportstate");var d="done";var g=this.search("workflow",c);if(g!=null){if(g.useridlist!=""){var h=HandleMemoStr(g.useridlist,false).split(",");var e=HandleMemoStr(g.finishtimelist,false).split(",");if(h.length>e.length){d=""}else{for(var f=0,a=h.length;f<a;f++){if(b!=""&&h[f]==b){continue}if(e[f]==""){d="";break}}}}}else{d="unknown"}return d};TCRSReportState.prototype.get_writer_list=function(b){var a=null;var c=this.search("workflow",b);if(c!=null){a={};a.arr_organid=HandleMemoStr(c.organidlist,false).split(",");a.arr_userid=HandleMemoStr(c.useridlist,false).split(",");a.arr_finishtime=HandleMemoStr(c.finishtimelist,false).split(",")}return a};TCRSReportState.prototype.get_done_task=function(){if(!this.doLoaded&&!crsReport.has_workflow()){this.doLoaded=true}this.loadData("#tablecrs_reportstate");var b=[];if(!this.isEmpty()){var a=this.first();while(!this.EOF()){var g=a.workflow;g=crsReport.crsWorkflow.get_valid_task(g);if(g==crsReport.s_begin_task){g=""}if(b.indexOf(g)==-1){var h=a.useridlist.split(",");var d=a.finishtimelist.split(",");var e=h.length_without_null,c=d.length_without_null;if(g==""){if(crsReport.s_write_mode=="y"){if(e<=c){b.push(g)}}else{if(c>0){b.push(g)}}}else{var f=crsReport.crsWorkflow.get_schedule(g);if(f!="\u62a2\u5148\u5f0f"){if(e<=c){b.push(g)}}else{if(c>0){b.push(g)}}}}a=this.next()}}return(b.length_without_null()<=0)?null:b};TCRSReportState.prototype.get_data_flow=function(b){this.loadData();var a=this.search("workflow",b);if(a!=null){return HandleMemoStr(a.dataflow,false).replaceAll("&gt;",">")}return""};
