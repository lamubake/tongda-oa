function TCRSFormView(b){this.obj_detail_dump_row={};this.arr_action_maps=null;this.obj_coord_to_kid_map=null;this.obj_cur_editor=null;this.i_default_height=200}TCRSFormView.prototype={constructor:TCRSFormView,set_coord_to_kid_map:function(){this.obj_coord_to_kid_map={};if(!crsReport.crsTableIndex.isEmpty()){var j=crsReport.crsTableIndex.first();while(!crsReport.crsTableIndex.EOF()){if(this.obj_coord_to_kid_map[j.sheetindex-1]==undefined){this.obj_coord_to_kid_map[j.sheetindex-1]={}}var m=crsReport.crsTableIndex.getColumn(j.id);if(j.tabletype=="\u4e3b\u8868"){if(this.obj_coord_to_kid_map[j.sheetindex-1]["m"]==undefined){this.obj_coord_to_kid_map[j.sheetindex-1]["m"]={}}if(!m.isEmpty()){var i=m.first();while(!m.EOF()){var n=crsReport.crsTableIndex.getAColSchema(i.kid);var k=n.display_rect;this.obj_coord_to_kid_map[j.sheetindex-1]["m"][k[0].x+"_"+k[0].y]=n;i=m.next()}}}else{if(j.tabletype=="\u660e\u7ec6\u8868"){if(this.obj_coord_to_kid_map[j.sheetindex-1]["d"]==undefined){this.obj_coord_to_kid_map[j.sheetindex-1]["d"]=[]}if(!m.isEmpty()){var i=m.first();while(!m.EOF()){var n=crsReport.crsTableIndex.getAColSchema(i.kid);var k=n.display_rect;var h={};if(j.expandtype=="\u6309\u884c\u5411\u4e0b"||j.expandtype=="\u4e0d\u6269\u5c55"){var l=k[1].y-k[0].y+1;h={x1:k[0].x,y1:k[0].y,x2:k[1].x,y2:k[1].y+(j.initcz-1)*l,col:n}}this.obj_coord_to_kid_map[j.sheetindex-1]["d"].push(h);i=m.next()}}this.auto_increment(j,m)}}j=crsReport.crsTableIndex.next()}}},_get_td_by_coord:function(t,p,q,w){var o=null,r=null;if(w==undefined){w=false}if(this.obj_coord_to_kid_map!=undefined){if(this.obj_coord_to_kid_map[t]!=undefined){if(this.obj_coord_to_kid_map[t]["m"]!=undefined){r=this.obj_coord_to_kid_map[t]["m"][p+"_"+q];if(r!=undefined){if(w){return r}var s=crsReport.crsTableIndex.rows[r.row_idx];o=$("#main_tab_"+s.id+" td[cid='"+r.kid+"']")}}if(o==null){if(this.obj_coord_to_kid_map[t]["d"]!=undefined){for(var v=0,u=this.obj_coord_to_kid_map[t]["d"].length;v<u;v++){var x=this.obj_coord_to_kid_map[t]["d"][v];if(x.x1<=p&&x.x2>=p&&x.y1<=q&&x.y2>=q){r=x.col;if(w){return r}var z=r.get_display_seq(p,q);var s=crsReport.crsTableIndex.rows[r.row_idx];var y=$("#detail_tab_"+s.id).children().eq(0).children("tr").eq(z);var i="detail_tab_"+s.id+"_"+r.kid;o=$(y).children("td[aria-describedby='"+i+"']");break}}}}}}return o},_get_td_and_schema_by_coord:function(r,n,o){var i={};if(this.obj_coord_to_kid_map!=undefined){if(this.obj_coord_to_kid_map[r]!=undefined){if(this.obj_coord_to_kid_map[r]["m"]!=undefined){i.schema=this.obj_coord_to_kid_map[r]["m"][n+"_"+o];if(i.schema!=undefined){var q=crsReport.crsTableIndex.rows[i.schema.row_idx];i.td=$("#main_tab_"+q.id+" td[cid='"+i.schema.kid+"']")}}if(i.schema==undefined){if(this.obj_coord_to_kid_map[r]["d"]!=undefined){for(var s=0,p=this.obj_coord_to_kid_map[r]["d"].length;s<p;s++){var t=this.obj_coord_to_kid_map[r]["d"][s];if(t.x1<=n&&t.x2>=n&&t.y1<=o&&t.y2>=o){i.schema=t.col;var v=i.schema.get_display_seq(n,o);var q=crsReport.crsTableIndex.rows[i.schema.row_idx];var u=$("#detail_tab_"+q.id).children().eq(0).children("tr").eq(v);var m="detail_tab_"+q.id+"_"+i.schema.kid;i.td=$(u).children("td[aria-describedby='"+m+"']");break}}}}}}if(i.td!=undefined&&i.td.length<1){i.td=undefined}return i},_add_action_maps:function(b){if(!crsReport.b_has_inline_calcu){return}if(this.arr_action_maps==null){this.arr_action_maps=b}else{this.arr_action_maps=this.arr_action_maps.concat(b)}},calculate:function(d,c){if(d==undefined){d=false}if(this.arr_action_maps==null){return}d=!d;crsReport.crsDataSet.calculate(this.arr_action_maps,this._fill_calculate_val,this,d,c);this.arr_action_maps=null},_fill_calculate_val:function(d,f,e){f.arr_action_maps=null;if(e!=undefined&&e){crsReport.crsDataSet.save_as_excel(crsReport.s_repname)}$.each(d,function(b,a){if(a!=undefined){f._set_cell_value(a.pg,a.x,a.y,a.val,true)}})},_set_cell_value:function(p,k,m,n,o){var r=this._get_td_and_schema_by_coord(p,k,m);var j=r.td;if($(j).length>0){if(n!=""&&r.schema.datatype=="\u4ee3\u7801\u578b"){if(r.schema.codeid==-11){var q=crsReport.crsUserCache.get_id_by_name(n);$(j).children().eq(1).val(n);n=q}}var l=r.schema.col.rows[r.schema.col_idx].refrepid;if(n!=""&&l!=""&&l!="0"){$(j).html("<a href='javascript:' target='_blank' onclick='crsReport.on_dblclick(event); return false;' style='text-decoration: underline'>"+format_text(r.schema.kid,n)+"</a>")}else{$(j).children().eq(0).val(format_text(r.schema.kid,n))}this.set_cell_value(p,k,m,n,j,r.schema.kid,o)}},set_cell_pvalue:function(j,h,f,i){var g=this._get_td_by_coord(j,h,f);if($(g).length>0){$(g).attr("pval",i)}},get_cell:function(d,e,f){return this._get_td_by_coord(d,e,f)},get_cell_attr:function(i,j,l,k){var m=this._get_td_and_schema_by_coord(i,j,l);var p=m.td;var o="";if(p!=undefined){o=$(p).attr(k);if(o==undefined&&k=="cid"){o=$(p).attr("aria-describedby");if(o!=undefined){var n=o.indexOf("{");if(n==-1){}o=o.substr(n)}}}else{if(k=="cid"){o=m.schema.kid}}return o!=undefined?o:""},get_cell_value:function(p,m,q){if(q!=undefined){var o=this._get_td_and_schema_by_coord(p,m,q);var k=o.td}else{if(m!=undefined){var l=crsReport.crsTableIndex.getAColSchema(p);var j=l.get_cell_point(m);return this.get_cell_value(0,j.x,j.y)}else{var k=p}}if(k!=undefined){var n=$(k).attr("val");if(n==undefined){n=$(k).attr("val2")}}else{if(m!=undefined){var r=o.schema.get_display_seq(m,q);n=crsReport.crsTableIndex.get_hidden_cell_value(o.schema.kid,r)}}return n!=undefined?n:""},set_cell_value:function(n,k,h,l,m,j,i){if(m==undefined){m=this._get_td_by_coord(n,k,h)}if(i==undefined){i=false}if($(m).attr("val")!=l){$(m).attr("val",l);if(!i){crsReport.crsCommon.add_action_maps(["set",n,k,h,l])}}},set_cell_value2:function(n,k,h,l,m,j,i){if(m==undefined){m=this._get_td_by_coord(n,k,h)}if(i==undefined){i=false}if($(m).attr("val2")!=l){$(m).attr("val2",l);if(!i){crsReport.crsCommon.add_action_maps(["set",n,k,h,l])}}},set_hidden_cell_value:function(g,i,h,j){var k=this._get_td_by_coord(g,i,h,true);var l=k.get_display_seq(i,h);crsReport.crsTableIndex.set_hidden_cell_value(k.kid,l,j)},set_hidden_cell_pvalue:function(g,i,h,j){var k=this._get_td_by_coord(g,i,h,true);var l=k.get_display_seq(i,h);crsReport.crsTableIndex.set_hidden_cell_value(k.kid,l,j,true)},_get_cid:function(b){return $(b).attr("id")},_get_rid:function(d){var c=$(d).parent().siblings().eq(0);c=$(c).text();return c},_get_cid_by_td:function(e){var f=$(e).attr("cid");if(f==undefined){f=$(e).attr("aria-describedby");var d=f.indexOf("{");if(d==-1){return""}f=f.substr(d)}return f},_get_rid_by_td:function(d){var c=$(d).siblings().eq(0);c=$(c).text();return c},_get_row_seq:function(k){var l=$(k).parent().children();var g=$(k).attr("id");var j=1;for(var h=l.length;j<h;j++){var i=$(l[j]).attr("id");if(i==g){break}}return j},_add_row:function(e,g){var h=this;if(e.data!=undefined){e.stopPropagation();h=e.data.me;e=e.data.tabid}var f=crsReport.crsTableIndex.getColumn(e);if(h.obj_detail_dump_row["tab_"+e]!=undefined){h.obj_detail_dump_row["tab_"+e]["kid"]=crsReport.crsTableIndex.create_row_kid(f.rows[0].kid);if(g!=undefined){$("#detail_tab_"+e).jqGrid("addRowData",h.obj_detail_dump_row["tab_"+e]["kid"],h.obj_detail_dump_row["tab_"+e],"before",g)}else{$("#detail_tab_"+e).jqGrid("addRowData",h.obj_detail_dump_row["tab_"+e]["kid"],h.obj_detail_dump_row["tab_"+e],"last")}}if(h.obj_default_val!=undefined&&h.obj_default_val["tab_"+e]!=undefined){$("table[id='detail_tab_"+e+"'] tr[id='"+h.obj_detail_dump_row["tab_"+e]["kid"]+"'] td").each(function(){var b=$(this).attr("aria-describedby");var a=b.indexOf("{");if(a!==-1){b=b.substr(a);if(h.obj_default_val["tab_"+e][b]!=undefined){$(this).attr("val",h.obj_default_val["tab_"+e][b])}}})}},_delete_row:function(h,j){var i=crsReport.crsTableIndex.search("id",h);if(i.initcz==1){alert("\u660e\u7ec6\u8868\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u4e0d\u80fd\u5220\u9664\uff01");return}var m=this._get_row_seq($(j).parent().parent());var k=$(j).parent().siblings().eq(2).attr("aria-describedby");var l=k.indexOf("{");k=k.substr(l);this._update_cell_refer(k,m,"del");var n=$(j).parent().siblings().eq(0);n=$(n).text();$("#detail_tab_"+h).jqGrid("delRowData",n);i.initcz=parseInt(i.initcz)-1;this.set_coord_to_kid_map()},_insert_row:function(h,j){var n=$(j).parent().siblings().eq(0);n=$(n).text();var m=this._get_row_seq($(j).parent().parent());var k=$(j).parent().siblings().eq(2).attr("aria-describedby");var l=k.indexOf("{");k=k.substr(l);var i=crsReport.crsTableIndex.search("id",h);this._update_cell_refer(k,m,"ins");this._add_row(h,n);i.initcz=parseInt(i.initcz)+1;this.set_coord_to_kid_map()},_get_position:function(e,f){var h=crsReport.crsTableIndex.getAColSchema(e);var g=h.get_cell_rect(f);return g},_update_cell_refer:function(k,q,j,n){if(n==undefined){n=1}var m=crsReport.crsTableIndex.getAColSchema(k);var p=crsReport.crsTableIndex.rows[m.row_idx];var o=m.col.rows[m.col_idx];var r=m.get_cell_rect(q);var l=r[1].y-r[0].y+1;if(j=="ins"||j=="app"){crsReport.crsCommon.add_action_maps([j,parseInt(p.sheetindex)-1,r[0].y,n*l,l])}else{crsReport.crsCommon.add_action_maps([j,parseInt(p.sheetindex)-1,r[0].y,n*l])}crsReport.crsChartCache.update_ref(parseInt(p.sheetindex),r[0].y,n*l,j,false);crsReport.crsTableIndex.update_cell_refer(parseInt(p.sheetindex),p.expandtype,r,n,j=="ins"||j=="app")},auto_increment:function(j,l){if(j.tabletype=="\u660e\u7ec6\u8868"){var m=parseInt(j.sheetindex)-1;if(!l.isEmpty()){var k=l.first();while(!l.EOF()){if(k.datatype=="\u81ea\u589e\u578b"){var i=rectNameToIndex(k.cellspan);if(j.expandtype=="\u6309\u884c\u5411\u4e0b"||j.expandtype=="\u4e0d\u6269\u5c55"){var n=i[1].y-i[0].y+1;for(var h=0;h<j.initcz;h++){this._set_cell_value(m,i[0].x,i[1].y+h*n,h+1)}}}k=l.next()}}}},append_record:function(j,l,h){var m=this;if(j.data!=undefined){j.stopPropagation();m=j.data.me;l=j.data.obj_col;j=j.data.obj_tab}if(h==undefined){h=1}if(j.expandtype=="\u6309\u884c\u5411\u4e0b"){var n=l.get_cell_rect(j.initcz);var k=n[1].y-n[0].y+1;m._update_cell_refer(l.kid,j.initcz,"app",h);for(var i=0;i<h;i++){m._add_row(j.id)}j.initcz=parseInt(j.initcz)+h;m.set_coord_to_kid_map()}},clear_cell:function(p,n,q){var o=this._get_td_and_schema_by_coord(p,n,q);var l=o.td;if(l!=undefined){$(l).attr("val2","");$(l).attr("val","");$(l).empty();var k=this._get_cid_by_td(l);var j=o.schema;var m=crsReport.crsTableIndex.rows[j.row_idx];if($(l).html().indexOf("</select>")!=-1){$($(l).html()).attr("selectedIndex",0)}else{$(l).html(crsReport.crsCommon._get_editor(this._get_rid_by_td(l),j))}}else{var r=o.schema.get_display_seq(n,q);crsReport.crsTableIndex.clear_hidden_cell_value(o.schema.kid,r)}crsReport.crsCommon.add_action_maps(["set",p,n,q,""])},delete_record:function(n,p,m,q){var o=this._get_td_and_schema_by_coord(p,m,q);var k=o.td,l=o.schema.kid,r;if(k!=undefined){r=this._get_row_seq($(k).parent("tr"));var j=$(k).siblings().eq(0);j=$(j).text();$("#detail_tab_"+n.id).jqGrid("delRowData",j)}else{r=o.schema.get_display_seq(m,q);crsReport.crsTableIndex.delete_hidden_row(l,r)}this._update_cell_refer(l,r,"del");n.initcz=parseInt(n.initcz)-1;this.set_coord_to_kid_map()},set_cell_backgroud_color:function(j,f,i,h){var g=this._get_td_by_coord(j,f,i);$(g).children("input").each(function(){if(h!=undefined){$(this).css("background-color",h)}else{$(this).css("background-color","")}})},_draw_a_td:function(v,s,w,o,r,q,y){if(o.ismust){var u="Red"}else{var u=""}var t="";if(v){var x=o.col.obj_data_cache.get_nth_by_col_name("col"+q.id);t=HandleMemoStr(y[x],false);if(t=="null"){t=""}if((q.datatype=="\u8d27\u5e01\u578b"||q.datatype=="\u6570\u503c\u578b")&&parseFloat(t)==0||q.datatype=="\u65e5\u671f\u578b"&&(t=="0"||t=="0000-00-00 00:00:00"||t=="0000-00-00"||t=="00:00:00")){t=""}}else{t=crsReport.get_val_from_para(o.kid);if(t==""){t=q.defaultval}}var p={val:""};if(o.canread){p.val=t}var n=crsReport.crsCommon._get_editor(w,o,p);if(p.val!=t){t=p.val}if(q.has_inline_calcu!="y"){var m=rectNameToIndex(q.cellspan);crsReport.crsCommon.add_action_maps(["set",parseInt(r.sheetindex)-1,m[0].x,m[0].y,t])}s+='<td width="150" class="TableLabel" nowrap=""><span title="" class="TableContent '+u+'">'+q.columnlabel+'</span></td><td class="TableData Width40" cid="'+q.kid+'"'+((v)?(' pval="'+t+'"'):"")+' val="'+t+'">'+n+"</td>";return s},draw_form:function(ap){if(ap){var ak=crsReport.crsTableIndex.getFirstTable();while(ak!=null){var av=ak[1]-1;var ao=rectNameToIndex(ak[5]);if(ak[3]<1){ak[3]=1}if(ak[0]=="\u660e\u7ec6\u8868"){if(ak[2]=="\u6309\u884c\u5411\u4e0b"){if(ak[4]>ak[3]){crsReport.crsTableIndex.update_cell_refer(parseInt(av)+1,ak[2],ao,ak[4]-ak[3],true);crsReport.crsCommon.add_action_maps(["app",parseInt(av)+1,ao[0].y,(ak[4]-ak[3])*(ao[1].y-ao[0].y+1),(ao[1].y-ao[0].y+1)])}}else{if(ak[2]=="\u6309\u5217\u5411\u53f3"){if(ak[4]>ak[3]){crsReport.crsTableIndex.update_cell_refer(parseInt(av)+1,ak[2],ao,ak[4]-ak[3],true);crsReport.crsCommon.add_action_maps(["app",parseInt(av)+1,ao[0].x,(ak[4]-ak[3])*(ao[1].x-ao[0].x+1),(ao[1].x-ao[0].x+1)])}}}}ak=crsReport.crsTableIndex.getNextTable()}}this.set_coord_to_kid_map();$('<form name="my_form" method="post" enctype="multipart/form-data" action="" target=""/>').appendTo($("body"));$('<div id="id_select" style="width: 250px;height:250px;background-color: #ffffff;overflow:auto;z-index: 1999;position: absolute;display:none;"></div>').appendTo($("body"));var al=this;if(!crsReport.crsTableIndex.isEmpty()){var T=3;var af,aw;var X=crsReport.crsTableIndex.first();while(!crsReport.crsTableIndex.EOF()){var ar=crsReport.crsTableIndex.getColumn(X.id);var ad,at,ab;if(X.tabletype=="\u4e3b\u8868"&&ar.length()>0){var j="";var aa=0,Y=0;var ax="",an=ar.arr_output_cols.length,k=0;if(ap){ab=ar.obj_data_cache.rows[0];ad=ar.obj_data_cache.get_nth_by_col_name("kid");ax=ab[ad];if(ar.arr_hidden_cols!=null){for(var r=0,aj=ar.arr_hidden_cols.length;r<aj;r++){aw=ar.rows[ar.arr_hidden_cols[r]];ad=ar.obj_data_cache.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(ab[ad],false);var V=rectNameToIndex(aw.cellspan);this.set_hidden_cell_pvalue(parseInt(X.sheetindex)-1,V[0].x,V[0].y,at)}}}else{ax=crsReport.crsTableIndex.create_row_kid(ar.rows[0].kid)}if(ar.arr_picture_cols!=null){if(j==""){j='<div id="main_tab_'+X.id+'"><ul><li><a href="#m_tab_'+X.id+'">'+X.label+'</a></li></ul><div id="m_tab_'+X.id+'"><table width="100%" id="main_tab_'+X.id+'" align="center" class="App_TableBlock" border="0" cellspacing="0"><tbody>'}aa=ar.arr_picture_cols.length;if(aa*T<=an){for(var R=0;R<aa;R++){for(var S=0;S<T;S++){aw=ar.rows[ar.arr_output_cols[k++]];af=crsReport.crsTableIndex.getAColSchema(aw.kid);j+="<tr rid='"+ax+"'>";j=this._draw_a_td(ap,j,ax,af,X,aw,ab);if(S==0){af=crsReport.crsTableIndex.getAColSchema(ar.arr_picture_cols[R]);aw=af.col.rows[af.col_idx];if(af.ismust){var ag=" Red"}else{var ag=""}if(ap){ad=ar.obj_data_cache.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(ab[ad],false);if(at=="null"){at=""}}else{at=""}var am={val:""};if(af.canread){am.val=at}var W=crsReport.crsCommon._get_editor(ax,af,am);at=am.val;if(aw.has_inline_calcu!="y"){var ac=rectNameToIndex(aw.cellspan);crsReport.crsCommon.add_action_maps(["set",parseInt(X.sheetindex)-1,ac[0].x,ac[0].y,at])}j+='<td width="150" class="TableLabel" rowspan='+T+' nowrap="" style="vertical-align: middle;"><span title="" class="TableContent'+ag+'">'+aw.columnlabel+'</span></td><td class="TableData Width40" rowspan='+T+' cid="'+aw.kid+'"'+((ap)?(' pval="'+at+'"'):"")+' val="'+((ap)?at:"")+'" style="vertical-align: middle;">'+W+"</td>"}j+="</tr>"}}}else{for(var R=0;R<aa;R++){for(var S=0;S<T;S++){j+="<tr rid='"+ax+"'>";if(S==0){af=crsReport.crsTableIndex.getAColSchema(ar.arr_picture_cols[R]);aw=af.col.rows[af.col_idx];if(af.ismust){var ag=" Red"}else{var ag=""}if(ap){ad=ar.obj_data_cache.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(ab[ad],false);if(at=="null"){at=""}}else{at=""}var am={val:""};if(af.canread){am.val=at}var W=crsReport.crsCommon._get_editor(ax,af,am);at=am.val;if(aw.has_inline_calcu!="y"){var ac=rectNameToIndex(aw.cellspan);crsReport.crsCommon.add_action_maps(["set",parseInt(X.sheetindex)-1,ac[0].x,ac[0].y,at])}j+='<td width="150" class="TableLabel" rowspan='+T+' nowrap="" style="vertical-align: middle;"><span title="" class="TableContent'+ag+'">'+aw.columnlabel+'</span></td><td class="TableData Width40" rowspan='+T+' cid="'+aw.kid+'"'+((ap)?(' pval="'+at+'"'):"")+' val="'+((ap)?at:"")+'" style="vertical-align: middle;">'+W+"</td>"}if(k<an){aw=ar.rows[ar.arr_output_cols[k++]];af=crsReport.crsTableIndex.getAColSchema(aw.kid);j=this._draw_a_td(ap,j,ax,af,X,aw,ab)}else{j+='<td class="TableLabel" colspan=2>&nbsp;</td>'}j+="</tr>"}}}if(k>=an){j+="</tbody></table></div></div>"}}while(k<an){if(j==""){j='<div id="main_tab_'+X.id+'"><ul><li><a href="#m_tab_'+X.id+'">'+X.label+'</a></li></ul><div id="m_tab_'+X.id+'"><table width="100%" id="main_tab_'+X.id+'" align="center" class="App_TableBlock" border="0" cellspacing="0"><tbody>'}aw=ar.rows[ar.arr_output_cols[k++]];af=crsReport.crsTableIndex.getAColSchema(aw.kid);if(Y%2==0){j+="<tr rid='"+ax+"'>"}j=this._draw_a_td(ap,j,ax,af,X,aw,ab);if(Y%2==1){j+="</tr>"}Y++}if(Y>0){if(Y%2==1){j+='<td class="TableLabel" colspan=2>&nbsp;</td></tr>'}j+="</tbody></table></div></div>"}if(j!=""){$(j).appendTo($("body > form"))}ar.arr_picture_cols=null;ar.arr_output_cols=null;ar.arr_hidden_cols=null}else{if(X.tabletype=="\u660e\u7ec6\u8868"){if(!ar.isEmpty()){var i,i,U="",Z="";aw=ar.first();while(!ar.EOF()){af=crsReport.crsTableIndex.getAColSchema(aw.kid);if(!af.canwrite&&!af.canread){}else{if(U==""){if(crsReport.openMode=="read"){i=["kid"],obj_col_model=[{name:"kid",index:"kid",hidden:true}]}else{i=["kid","\u64cd\u4f5c"],obj_col_model=[{name:"kid",index:"kid",hidden:true},{name:"ope",index:"ope",width:35,sortable:false,fixed:true}]}U='<li><a href="#tab_'+X.id+'">'+X.label+"</a></li>";Z='<div id="tab_'+X.id+'" align="center"><table id="detail_tab_'+X.id+'"><tr><td></td></tr></table><div id="pager_detail_tab_'+X.id+'"></div></div>';if(crsReport.openMode=="read"){}else{al.obj_detail_dump_row["tab_"+X.id]={kid:"",ope:'<img title="\u63d2\u5165" onclick="crsReport.crsCommon.crsForm._insert_row('+X.id+', this)" src="/static/modules/reportshop/images/Update.ico" border="0" style="cursor:pointer"><img title="\u5220\u9664" onclick="crsReport.crsCommon.crsForm._delete_row('+X.id+', this)" src="/static/modules/reportshop/images/delete.gif" border="0" style="cursor:pointer">'}}}i.push(aw.columnlabel);obj_col_model.push({name:aw.kid,index:aw.kid,sortable:false,width:(aw.columnlabel.length<4?4:aw.columnlabel.length)*60});if(crsReport.openMode=="read"){}else{if(af.canread&&aw.defaultval!=""){var am={val:aw.defaultval};al.obj_detail_dump_row["tab_"+X.id][aw.kid]=crsReport.crsCommon._get_editor(ax,af,am)+"</td>"}else{var am={val:""};al.obj_detail_dump_row["tab_"+X.id][aw.kid]=crsReport.crsCommon._get_editor(ax,af,am)+"</td>"}if(crsReport.openMode!="read"&&aw.defaultval!=""){if(al.obj_default_val==undefined){al.obj_default_val={}}if(al.obj_default_val["tab_"+X.id]==undefined){al.obj_default_val["tab_"+X.id]={}}al.obj_default_val["tab_"+X.id][aw.kid]=aw.defaultval}}}aw=ar.next()}if(U!=""){if($("#detail_tabs").length<=0){$('<div id="detail_tabs"><ul>'+U+"</ul>"+Z+"</div>").appendTo($("body > form"))}else{$(U).appendTo($("#detail_tabs ul"));$(Z).appendTo($("#detail_tabs"))}$("#detail_tab_"+X.id).jqGrid({datatype:"local",height:this.i_default_height,width:"100%",colNames:i,colModel:obj_col_model,pager:"#pager_detail_tab_"+X.id,sortname:"id",viewrecords:true,sortorder:"desc"});if(crsReport.openMode=="write"){for(var r=0;r<X.initcz;r++){al._add_row(X.id)}}else{var ah=ar.obj_data_cache;if(!ah.isEmpty()){var ab=ah.first();var ae=ah.get_nth_by_col_name("kid");while(!ah.EOF()){var au=null,ai={};if(crsReport.openMode=="read"){au={kid:ab[ae]}}else{au={kid:ab[ae],ope:'<img title="\u63d2\u5165" onclick="crsReport.crsForm._insert_row('+X.id+', this)" src="/static/modules/reportshop/images/Update.ico" border="0" style="cursor:pointer"><img title="\u5220\u9664" onclick="crsReport.crsCommon.crsForm._delete_row('+X.id+', this)" src="/static/modules/reportshop/images/delete.gif" border="0" style="cursor:pointer">'}}aw=ar.first();while(!ar.EOF()){af=crsReport.crsTableIndex.getAColSchema(aw.kid);if(!af.canwrite&&!af.canread){ad=ah.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(ab[ad],false);var V=af.get_cell_rect(parseInt(ab[10]));this.set_hidden_cell_pvalue(parseInt(X.sheetindex)-1,V[0].x,V[0].y,at)}else{if(af.canread){ad=ah.get_nth_by_col_name("col"+aw.id);at=HandleMemoStr(ab[ad],false);if(at=="null"){at=""}if((aw.datatype=="\u8d27\u5e01\u578b"||aw.datatype=="\u6570\u503c\u578b")&&parseFloat(at)==0||aw.datatype=="\u65e5\u671f\u578b"&&(at=="0"||at=="0000-00-00 00:00:00"||at=="0000-00-00"||at=="00:00:00")){at=""}}else{at=""}var am={val:at};au[aw.kid]=crsReport.crsCommon._get_editor(ab[ae],af,am)+"</td>";ai[aw.kid]=am.val;at=am.val}if(aw.has_inline_calcu!="y"){var ac=af.get_cell_rect(parseInt(ab[10]));crsReport.crsCommon.add_action_maps(["set",parseInt(X.sheetindex)-1,ac[0].x,ac[0].y,at])}aw=ar.next()}$("#detail_tab_"+X.id).jqGrid("addRowData",au.kid,au,"last");$("table[id='detail_tab_"+X.id+"'] tr[id='"+au.kid+"'] td").each(function(){var b=$(this).attr("aria-describedby");var a=b.indexOf("{");if(a!==-1){b=b.substr(a);$(this).attr("val",ai[b]);$(this).attr("pval",ai[b])}});var ab=ah.next()}}}$("#detail_tab_"+X.id).jqGrid("navGrid","#pager_detail_tab_"+X.id,{edit:false,del:false,search:false,refresh:false});$("#add_detail_tab_"+X.id+" span").bind("click",{obj_tab:X,obj_col:af,tabid:X.id,me:al},al.append_record)}}}}X=crsReport.crsTableIndex.next()}}try{if($("div[id^='main_tab_']").length>0){$("div[id^='main_tab_']").tabs()}}catch(e){}try{if($("#detail_tabs").length>0){$("#detail_tabs").tabs()}}catch(e){}if(!crsReport.crsChartCache.isEmpty()){U="",Z="";var aq=crsReport.crsChartCache.first();while(!crsReport.crsChartCache.EOF()){var s=getColPlatKId(aq.label);aq.label=s;aq.category_name=HandleMemoStr(aq.category_name,false);aq.series_name=HandleMemoStr(aq.series_name,false);U+='<li><a href="#'+s+'">'+aq.title+"</a></li>";Z+='<div id="'+s+'" style="min-width:450px;min-height:350px;"></div>';aq=crsReport.crsChartCache.next()}if(crsReport.crsChartCache.length()>1){if($("#detail_tabs").length>0){$("#detail_tabs").before($('<div id="chart_tabs" align="center"><ul>'+U+"</ul>"+Z+"</div>"))}else{$('<div id="chart_tabs" align="center"><ul>'+U+"</ul>"+Z+"</div>").appendTo($("body > form"))}try{if($("#chart_tabs").length>0){$("#chart_tabs").tabs()}}catch(e){}}else{if($("#detail_tabs").length>0){$("#detail_tabs").before($('<div id="chart_tabs" align="center">'+Z+"</div>"))}else{$('<div id="chart_tabs" align="center">'+Z+"</div>").appendTo($("body > form"))}}var aq=crsReport.crsChartCache.first();while(!crsReport.crsChartCache.EOF()){crsReport.crsChartCache.draw_chart(aq);aq=crsReport.crsChartCache.next()}}this.resize()},begin_update:function(){},end_update:function(){this.calculate();crsReport.crsChartCache.refresh()},resize:function(){var d=0;$("div[id^='main_tab_']").each(function(){d+=$(this).height()});var e=jQuery(window).width()-40;var f=jQuery(window).height()-d-125;if(e>this.i_default_height){jQuery("table[id^='detail_tab_']").jqGrid("setGridWidth",e);jQuery("#chart_tabs > div").width(e)}if(f>this.i_default_height){if(jQuery("#chart_tabs").length>0){if($("#detail_tabs").length>0){f-=$("#detail_tabs").height()}if(f>this.i_default_height){jQuery("#chart_tabs > div").height(f)}}else{jQuery("table[id^='detail_tab_']").jqGrid("setGridHeight",f)}}}};
