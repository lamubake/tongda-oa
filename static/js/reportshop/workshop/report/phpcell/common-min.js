function TCRSCommon(b){this.b_as_form=b;this.obj_cur_editor=null;this.arr_action_maps=null;if(this.b_as_form){this.crsForm=new TCRSFormView()}else{this.crsTable=new TCRSTableView()}this.b_has_excel_func=true;this.b_set_chart_actions=false;this.obj_sign_seals={}}TCRSCommon.prototype={constructor:TCRSCommon,add_action_maps:function(b){if(this.arr_action_maps==null){this.arr_action_maps=b}else{this.arr_action_maps=this.arr_action_maps.concat(b)}},draw:function(f){if(crsReport.b_has_sign_seal){$('<object classid="CLSID:77709A87-71F9-41AE-904F-886976F99E3E" style="position:absolute;width:0px;height:0px;left:0px;top:0px;display:none;" codebase="/module/websign/WebSign_trial.dll#version=4,5,0,0"></object>').appendTo($("body"));crsReport.DWebSignSeal=$("object[classid='CLSID:77709A87-71F9-41AE-904F-886976F99E3E']")[0];crsReport.DWebSignSeal.SetCurrUser(crsReport.s_writer+"["+crsReport.crsUserCache.get_name_by_id(crsReport.s_writer)+"]")}if(this.b_as_form){this.crsForm.draw_form(f)}else{this.crsTable.loadData(f)}if(crsReport.b_has_sign_seal){for(s_k in this.obj_sign_seals){crsReport.DWebSignSeal.SetStoreData(this.obj_sign_seals[s_k])}crsReport.DWebSignSeal.ShowWebSeals();var g=crsReport.DWebSignSeal.FindSeal("",0);while(g!=""){var e="";if(g.indexOf("_hw")>0){e=g.substring(0,g.indexOf("_hw"))}else{if(g.indexOf("_seal")>0){e=g.substring(0,g.indexOf("_seal"))}}if(e!=""){var h=GetDataStr(e);crsReport.DWebSignSeal.SetSealSignData(g,h);if($("#SIGN_POS_"+e).find("input[type='button']").length==0){crsReport.DWebSignSeal.SetMenuItem(g,4)}else{crsReport.DWebSignSeal.SetMenuItem(g,261)}}g=crsReport.DWebSignSeal.FindSeal(g,0)}}},get_row_seq:function(f){var h=1;if(this.b_as_form){h=this.crsForm._get_row_seq($(f).parent("tr"))}else{var g=this.crsTable.crsCellControler.get_cell_point(f);var e=crsReport.crsTableIndex.getAColSchema($(f).attr("cid"));h=e.get_display_seq(g.x,g.y)}return h},get_cell_attr:function(j,g,i,h){var f="";if(this.b_as_form){f=this.crsForm.get_cell_attr(j,g,i,h)}else{f=this.crsTable.crsCellControler.get_cell_attr(j,g,i,h)}return f},get_cell_value:function(q,n,r,s){if(s==undefined){s=false}if(r!=undefined){if(this.b_as_form){var o=this.crsForm._get_td_and_schema_by_coord(q,n,r);var l=o.td}else{var l=crsReport.crsCommon.crsTable.crsCellControler.get_cell(q,n,r)}}else{if(n!=undefined){var m=crsReport.crsTableIndex.getAColSchema(q);var k=m.get_cell_point(n);return this.get_cell_value(0,k.x,k.y)}else{var l=q}}if(l!=undefined){if(s){if($(l).children(":eq(0)").attr("type")!="hidden"){var p=$(l).children(":eq(0)").val()}else{var p=$(l).children(":eq(1)").val()}}else{var p=$(l).attr("val");if(p==undefined){p=$(l).attr("val2")}}}else{if(n!=undefined){var t=o.schema.get_display_seq(n,r);p=crsReport.crsTableIndex.get_hidden_cell_value(o.schema.kid,t)}}return p!=undefined?p:""},set_cell_value:function(r,n,p,q,k){var m={},s=false;if(p==undefined){m=r;q=n;if(this.b_as_form){k=crsReport.crsTableIndex.getAColSchema(this.crsForm._get_cid_by_td(r));s=k.col.rows[k.col_idx].has_inline_calcu=="y"}else{if(k==undefined){k=crsReport.crsTableIndex.getAColSchema($(m).attr("cid"))}s=$(m).attr("func")!=undefined}r=parseInt(crsReport.crsTableIndex.rows[k.row_idx].sheetindex)-1;var j=this.get_row_seq(m);var t=k.get_cell_point(j);n=t.x;p=t.y}else{if(this.b_as_form){m=this.crsForm._get_td_and_schema_by_coord(r,n,p);if(k==undefined){k=m.schema}m=m.td;s=k.col.rows[k.col_idx].has_inline_calcu=="y"}else{m=crsReport.crsCommon.crsTable.crsCellControler.get_cell(r,n,p);if(k==undefined){if($(m).attr("cid")==undefined){$(m).text(q);return}k=crsReport.crsTableIndex.getAColSchema($(m).attr("cid"))}s=$(m).attr("func")!=undefined}}if($(m).length>0){if(q!=""&&k.datatype=="\u4ee3\u7801\u578b"){if(k.codeid==-10){if(q!=""&&q.charAt(q.length-1)!=","){q=crsReport.crsDeptCache.get_id_by_name(q)+","}if($(m).children().eq(0).val()!=q){if(k.canread&&k.canwrite){$(m).children().eq(1).val(crsReport.crsDeptCache.get_name_list_by_id(q))}else{if(k.canread){q=crsReport.crsDeptCache.get_name_list_by_id(q)}}}}else{if(k.codeid==-11){if(q!=""&&q.charAt(q.length-1)!=","){q=crsReport.crsUserCache.get_id_by_name(q)+","}if($(m).children().eq(0).val()!=q){if(k.canread&&k.canwrite){$(m).children().eq(1).val(crsReport.crsUserCache.get_name_list_by_id(q))}else{if(k.canread){q=crsReport.crsUserCache.get_name_list_by_id(q)}}}}}}if(k.canread){var o=k.col.rows[k.col_idx].refrepid;if(q!=""&&o!=""&&o!="0"){var l="";if(!k.canwrite){l="return;"}$(m).html("<a href='javascript:' target='_blank' onclick='crsReport.on_dblclick(event); return false;' style='text-decoration: underline' onmouseover='crsReport.show_edit(this)'>"+format_text(k.kid,q)+"</a>")}else{$(m).children().eq(0).val(format_text(k.kid,q))}$(m).attr("val",q)}else{if(k.canwrite){$(m).attr("val2",q)}else{$(m).attr("val2",q)}}if(!s){this.add_action_maps(["set",r,n,p,q])}}else{this.crsForm.set_hidden_cell_value(r,n,p,q)}},set_cell_pvalue:function(e,g,f,h){if(this.b_as_form){this.crsForm.set_cell_pvalue(e,g,f,h)}else{this.crsTable.crsCellControler.set_cell_pvalue(e,g,f,h)}},set_hidden_cell_value:function(g,h,f,e){},set_hidden_cell_pvalue:function(g,h,f,e){},set_cell_backgroud_color:function(j,l,g,i,k){if(this.b_as_form){var h=this.crsForm._get_td_by_coord(j,l,g)}else{var h=crsReport.crsCommon.crsTable.crsCellControler.get_cell(j,l,g)}if($(h).length>0){if(i!=undefined){$(h).children().css("background-color",i)}else{$(h).children().css("background-color","")}}},clear_cell:function(f,d,e){if(this.b_as_form){this.crsForm.clear_cell(f,d,e)}else{this.crsTable.crsCellControler.clear_cell(f,d,e)}},add_option:function(c,d){this._add_option(c,d)},blur_handler:function(b){$(document).triggerHandler("click")},calculate:function(d,c){if(d==undefined){d=false}if(c==undefined){c=false}if(!c&&!crsReport.b_has_inline_calcu){return}if(this.arr_action_maps==null){return}d=!d;crsReport.crsDataSet.calculate(this.arr_action_maps,this.fill_calculate_val,this,!d,c);this.arr_action_maps=null},fill_calculate_val:function(d,f,e){f.arr_action_maps=null;if(e!=undefined&&e){crsReport.crsDataSet.save_as_excel(crsReport.s_repname)}$.each(d,function(b,a){if(a!=undefined){f.set_cell_value(a.pg,a.x,a.y,a.val)}})},save_as_excel:function(){if(!this.b_set_chart_actions){this.b_set_chart_actions=true;if(crsReport.has_chart()){}}if(this.arr_action_maps==null){crsReport.crsDataSet.save_as_excel(crsReport.s_repname)}else{this.calculate(false,true)}},begin_update:function(){},end_update:function(){this.calculate();crsReport.crsChartCache.refresh()},resize:function(){if(this.b_as_form){this.crsForm.resize()}},get_cid_by_td:function(c){var d="";if(this.b_as_form){d=this.crsForm._get_cid_by_td(c)}else{d=$(c).attr("cid")}return d},get_rid_by_td:function(c){var d="";if(this.b_as_form){d=this.crsForm._get_rid_by_td(c)}else{d=$(c).parent("tr").attr("rid")}return d},get_rid_and_cid:function(f){var e="";if(this.b_as_form){e=this.crsForm._get_rid_by_td(f)+this.crsForm._get_cid_by_td(f)}else{var d=$(f).parent("tr").attr("rid");if(d==undefined){d=$(f).attr("rid")}e=d+$(f).attr("cid")}return getColPlatKId(e)},_id:function(j){if($(j).attr("id")==undefined){return}var f=$(j).parent("td");if(f.length<1){f=$(j).parent().parent("td")}var g=$.md5(this.get_rid_and_cid(f));var i=$(j).attr("id");var h=i.indexOf("_t");if(h!=-1){i=i.substr(0,h)}else{h=i.indexOf("S_");if(h!=-1){i=i.substr(h+2)}}if(i!=g){$(f).html($(f).html().replaceAll(i,g))}},_get_editor:function(P,t,E){if(E==undefined){E={val:""}}var L=t.col.rows[t.col_idx];if(!t.canwrite&&!t.canread){if(L.datatype=="\u81ea\u52a8\u7f16\u53f7"){if(E!=undefined&&E.val==""){E.val=crsReport.crsAutoCode.get_next_autocode(L.codeid,true)}}return""}var s="";if(t.canread&&E!=undefined){s=E.val;if(s!=""){s=format_text(L.kid,s)}}if(L.info!=""){var I=L.info}else{var I=(s==""?L.columnlabel:L.columnlabel+"\uff1a"+s)}var S="";var Q=$.md5(getColPlatKId(P+L.kid));if(t.canwrite){if(L.datatype=="\u65e5\u671f\u578b"){var K="yyyy-MM-dd";if(L.displaystyle=="yyyy\u5e74mm\u6708dd\u65e5"||L.displaystyle=="yyyy-mm-dd"||L.displaystyle=="yyyy.mm.dd"){}else{if(L.displaystyle=="yyyy\u5e74mm\u6708"||L.displaystyle=="yyyy-mm"||L.displaystyle=="yyyy.mm"){K="yyyy-MM"}else{if(L.displaystyle=="yyyy\u5e74"){K="yyyy"}else{if(L.displaystyle=="h:mm:ss"){K="HH:mm:ss"}else{if(L.displaystyle=="mm"){K="MM"}else{if(L.displaystyle=="dd"){K="dd"}else{K="yyyy-MM-dd HH:mm:ss"}}}}}}S+='<input title="'+I+'" class="InputField Width90 dateField" onclick="if(crsReport.crsCommon._do_editor_active2(this)){WdatePicker({dateFmt:\''+K+"'});WdatePicker({dateFmt:'"+K+'\'});}" onfocus="$(this).addClass(\'InputFocus\');" onblur="$(this).removeClass(\'InputFocus\');" type="text" value="'+s+'" >'}else{if(L.datatype=="\u4ee3\u7801\u578b"){if(L.codeid=="-10"){if(s!=""){if(s.charAt(s.length-1)==","){s=crsReport.crsDeptCache.get_name_list_by_id(s)}else{s+=",";E.val=crsReport.crsDeptCache.get_id_list_by_name(s)}}S+='<input type="hidden" name="'+Q+'" id="'+Q+'" value="'+E.val+'" onchange="crsReport.crsCommon._do_editor_deactive(this);"/><input type="text" name="'+Q+'_text" id="'+Q+'_text" value="'+s+'" class="InputField Width90 userField"onmouseenter="crsReport.crsCommon._id(this);"onfocus="$(this).addClass(\'InputFocus\');" onblur="$(this).removeClass(\'InputFocus\');$(this).parent(\'td\').children().eq(0).change();"onclick="SelectDept(\'\', \''+Q+"', '"+Q+"_text', '', this.form.name);\" title=\""+I+'" readonly" ><a href="javascript:" onclick="document.getElementById(\''+Q+"').value = '';document.getElementById('"+Q+"_text').value='';$(this).parent('td').children().eq(0).change();return false;\" class=\"ref-delete-handle inline-block\" ></a>"}else{if(L.codeid=="-11"){if(s!=""){if(s.charAt(s.length-1)==","){s=crsReport.crsUserCache.get_name_list_by_id(s)}else{s+=",";E.val=crsReport.crsUserCache.get_id_list_by_name(s)}}S+='<input type="hidden" name="'+Q+'" id="'+Q+'" value="'+E.val+'" onchange="crsReport.crsCommon._do_editor_deactive(this);"/><input type="text" name="'+Q+'_text" id="'+Q+'_text" value="'+s+"\" class=\"InputField Width90 userField\"onmouseenter=\"crsReport.crsCommon._id(this);\"onfocus=\"$(this).addClass('InputFocus');\" onblur=\"$(this).removeClass('InputFocus');$(this).parent('td').children().eq(0).change();\"onclick=\"SelectUser('', '', '"+Q+"', '"+Q+"_text', '', this.form.name);\" title=\""+I+'" readonly ><a href="javascript:" onclick="document.getElementById(\''+Q+"').value = '';document.getElementById('"+Q+"_text').value='';$(this).parent().attr('val','');return false;\" class=\"ref-delete-handle inline-block\" ></a>"}else{if(parseInt(L.codeid)>0){var D=crsReport.crsCodeIndex.get_select(L.codeid,s);if(D==""){var M="";if(crsReport.crsCodeIndex.is_readonly(L.codeid)){M="readOnly"}var J=crsReport.crsCodeIndex.get_display_text_by_value(L.codeid,s);S+='<input type="hidden" name="'+Q+'" id="'+Q+'" value="'+s+'" onchange="crsReport.crsCommon._do_editor_deactive(this);"/><input class="InputField Width90 userField" onmouseenter="crsReport.crsCommon._id(this);"onfocus="$(this).addClass(\'InputFocus\');" onblur="$(this).removeClass(\'InputFocus\');"'+M+' id="'+Q+'_text" name="" size="20" class="BigInput" value="'+J+'" onClick="crsReport.crsCodeIndex.get_tree('+L.codeid+", '', 0, 1, 0, '', '"+Q+"', this);\" onchange=\"$(this).parent('td').children().eq(0).val($(this).val());$(this).parent('td').children().eq(0).change();\" ><a href=\"javascript:\" onclick=\"$('#"+Q+"').val('');$('#"+Q+"_text').val('');$(this).parent('td').children().eq(0).change();\" class=\"ref-delete-handle inline-block\" ></a>"}else{S+='<select onchange="crsReport.crsCommon._do_editor_deactive(this);">'+D+"</select>"}}else{if(L.codeid!=""){var U=HandleMemoStr(L.codeid,false).split("|");var O="";var C=false;for(var N=0,F=U.length;N<F;N++){if(N==0&&U[0]!=""){O+="<option value=''></option><option value='<\u8f93\u5165...>'><\u8f93\u5165...></option>"}var M=HandleMemoStr(U[N],false);if(M==s){if(!C){C=true}O+="<option value='"+M+"' selected>"+M+"</option>"}else{O+="<option value='"+M+"'>"+M+"</option>"}}if(!C&&s!=""){O+="<option value='"+s+"' selected>"+s+"</option>"}S+='<select onchange="crsReport.crsCommon._do_editor_deactive(this);">'+O+"</select>"}}}}}else{if(L.datatype=="\u903b\u8f91\u578b"){var R="";if(t.col.arr_radio_group!=undefined){for(var H=0,F=t.col.arr_radio_group.length;H<F;H++){if(t.col.arr_radio_group[H].indexOf(L.kid)!=-1){R=t.col.arr_radio_group[H];break}}}if(R!=""){S+='<input type="radio" name="'+P+R+'" title="'+L.columnlabel+'" id="'+Q+'" '+((s=="\u221a")?"checked":"")+">"+L.columnlabel}else{S+='<input type="checkbox" title="'+L.columnlabel+'" id="'+Q+'" '+((s=="\u221a")?"checked":"")+' onchange="crsReport.crsCommon._do_editor_deactive(this)">'+L.columnlabel}}else{if(L.datatype=="\u81ea\u52a8\u7f16\u53f7"){if(E.val==""){E.val=crsReport.crsAutoCode.get_next_autocode(L.codeid,true);if(t.canread){s=E.val}}S+='<input title="'+I+'" class="InputField Width90 " onfocus="$(this).addClass(\'InputFocus\')" type="text" maxlength="100"             onblur="$(this).removeClass(\'InputFocus\');" readonly value=\''+s+"'>"}else{if(L.datatype=="\u9644\u4ef6\u578b"){if(s!=""){var i=s.indexOf("_");var G=s.substr(i+1);E.val=G;S+="<a href='/attachment/reportshop/attachment/"+s+"' target='_blank' title='\u5355\u51fb\u6253\u5f00\u9644\u4ef6' onmouseover='crsReport.show_delete(this)' >"+G+"</a>"}else{S+='<a class="addfile" href="javascript:;">\u9009\u62e9\u9644\u4ef6<input class="addfile" hidefocus="true" type="file" size="1" id="'+Q+'" name="'+Q+'" onchange="crsReport.submit_attach(\''+Q+"', $(this).parent().parent(), '"+getColPlatKId(P+L.kid)+'\');" onclick="crsReport.crsCommon._id(this);"></a>'}}else{if(L.datatype=="\u56fe\u7247\u578b"){if(s!=""){var V=s.split(" ");var A=parseInt(V[4])-parseInt(V[2]),T=parseInt(V[5])-parseInt(V[3]);if(crsReport.openMode!="read"){A-=20}S+="<img src='/attachment/reportshop/images/"+V[0]+"' width='"+A+"' height='"+T+"' ondblclick='window.parent.float_image(this)' title='\u53cc\u51fb\u653e\u5927\u9884\u89c8' onmouseover='crsReport.show_delete(this)' />";E.val=V[0]}else{S+='<a class="addfile" href="javascript:;">\u9009\u62e9\u56fe\u7247<input class="addfile" hidefocus="true" type="file" size="1" id="'+Q+'" name="'+Q+'" accept="image/*" onchange="crsReport.submit_picture(\''+Q+'\', $(this).parent().parent());" onclick="crsReport.crsCommon._id(this);"></a>'}}else{if(L.datatype=="\u624b\u5199\u7b7e\u7ae0"){S+=this._get_sign_seal(Q,HandleMemoStr(L.radiogroup,false),t.canwrite);if(s!=""){this.obj_sign_seals[Q]=s}}else{var B=L.refrepid;if(s!=""&&B!=""&&B!="0"){S+="<a href='javascript:' target='_blank' onclick='crsReport.on_dblclick(event); return false;' style='text-decoration: underline' onmouseover='crsReport.show_edit(this)'>"+s+"</a>"}else{S+='<input title="'+I+'" class="InputField Width90 " onfocus="$(this).addClass(\'InputFocus\');crsReport.crsCommon._do_editor_active(this);" type="text" maxlength="100" value="'+s+'" onblur="$(this).removeClass(\'InputFocus\');crsReport.crsCommon._do_editor_deactive(this);">'}}}}}}}}}else{if(L.datatype=="\u81ea\u52a8\u7f16\u53f7"&&E!=undefined&&E.val==""){E.val=crsReport.crsAutoCode.get_next_autocode(L.codeid,true);if(t.canread){s=E.val}}if(L.datatype=="\u903b\u8f91\u578b"){S+='<input type="checkbox" title="'+L.columnlabel+'"'+((s=="\u221a")?"checked":"")+" disabled>"+L.columnlabel}else{if(s!=""){if(L.datatype=="\u9644\u4ef6\u578b"){var i=s.indexOf("_");var G=s.substr(i+1);E.val=G;S+="<a href='/attachment/reportshop/attachment/"+s+"' target='_blank' title='\u5355\u51fb\u6253\u5f00\u9644\u4ef6'>"+G+"</a>"}else{if(L.datatype=="\u56fe\u7247\u578b"){var V=s.split(" ");var A=parseInt(V[4])-parseInt(V[2]),T=parseInt(V[5])-parseInt(V[3]);E.val=V[0];S+="<img src='/attachment/reportshop/images/"+V[0]+"' width='"+A+"' height='"+T+"' ondblclick='window.parent.float_image(this)' title='\u53cc\u51fb\u653e\u5927\u9884\u89c8'/>"}else{if(L.datatype=="\u624b\u5199\u7b7e\u7ae0"){S+=this._get_sign_seal(Q,HandleMemoStr(L.radiogroup,false),t.canwrite);this.obj_sign_seals[Q]=s}else{if(L.datatype=="\u4ee3\u7801\u578b"){if(L.codeid=="-10"){if(s!=""){if(s.charAt(s.length-1)==","){s=crsReport.crsDeptCache.get_name_list_by_id(s)}else{s+=","}}}else{if(L.codeid=="-11"){if(s.charAt(s.length-1)==","){s=crsReport.crsUserCache.get_name_list_by_id(s)}else{s+=","}}else{if(parseInt(L.codeid)>0){s=crsReport.crsCodeIndex.get_display_text_by_value(L.codeid,s)}}}S+='<input title="'+I+'" class="InputField Width90 " type="text" maxlength="100" value="'+s+'"  readOnly>'}else{var B=L.refrepid;if(s!=""&&B!=""&&B!="0"){S+="<a href='javascript:' target='_blank' onclick='crsReport.on_dblclick(event); return false;' style='text-decoration: underline'>"+s+"</a>"}else{S+='<input title="'+I+'" class="InputField Width90 " type="text" maxlength="100" value="'+s+'"  readOnly>'}}}}}}else{S+='<input title="'+I+'" class="InputField Width90 " type="text" maxlength="100" readOnly>'}}}return S},_add_option:function(j,h,k){if(k==undefined){k=false}var i=false;var g=0;$(j).children().each(function(){if($(this).text()==h){i=true;return false}g++});if(!i){var l="<option value='"+h+"'>"+h+"</option>";$(j).append(l);if(k){$(j)[0].selectedIndex=$(j).children().length-1}}},_do_editor_active2:function(b){if(b.tagName!=undefined&&b.tagName.toLowerCase()=="input"){this._do_editor_active(b);this.obj_cur_editor=b;$(document).one("click",function(a){crsReport.crsCommon._do_editor_deactive(crsReport.crsCommon.obj_cur_editor);crsReport.crsCommon.obj_cur_editor=null});window.event.cancelBubble=true;return true}},_do_editor_deactive2:function(b){},_do_editor_active:function(f){if(null!=this.obj_cur_editor&&f!=this.obj_cur_editor){$(document).triggerHandler("click")}var d=$(f).parent();if($(d).attr("val")!=undefined){if($(d).attr("val")!=$(f).val()){var e=getCursorPos(f);$(f).val($(d).attr("val"));if(e>$(d).attr("val").length){e=$(d).attr("val").length}setCursorPos(f,e)}else{}}},_do_editor_deactive:function(q){if(q==undefined){return}var A=$(q).parent();var w=$(A).parent();var v="input";if(typeof q=="string"){}else{if(q.tagName!=undefined){v=q.tagName.toLowerCase()}}if(v=="input"||v=="select"||v=="textarea"){var y="";if(typeof q=="string"){y=q}else{if($(q).attr("type")=="radio"||$(q).attr("type")=="checkbox"){y=q.checked?"\u221a":""}else{y=$(q).val()}if(y=="<\u8f93\u5165...>"){$(q).hide();var p='<input class="InputField Width90" onfocus="this.className=\'InputFocus Width90\'" onblur="this.className=\'InputField Width90\';crsReport.crsCommon._do_editor_deactive(this);crsReport.crsCommon._add_option($(this).parent(\'td\').children().eq(0), $(this).val(), true);$(this).parent(\'td\').children().eq(0).show();$(this).remove();" size="20" class="BigInput" value="'+(($(A).attr("val")==undefined)?"":$(A).attr("val"))+'">';$(A).append(p);return}}var t=$(A).attr("cid");if(t==undefined){t=$(A).attr("aria-describedby");if(t!=undefined){var B=t.indexOf("{");if(B==-1){}t=t.substr(B)}}var r=crsReport.crsTableIndex.getAColSchema(t);var u=r.check_value(y);if(u!=""){alert(u);return}var z=false;if($(A).attr("val")==undefined||$(A).attr("val")!=y){z=true}if(crsReport.b_as_form){var C=crsReport.crsCommon.crsForm._get_row_seq(w);var D=r.get_cell_point(C)}else{var D=crsReport.crsCommon.crsTable.crsCellControler.get_cell_point(A);var C=r.get_display_seq(D.x,D.y)}var x=crsReport.crsTableIndex.rows[r.row_idx];var s=format_text(t,y);$(q).val(s);if(r.col.rows[r.col_idx]==""&&$(q).attr("title")!=undefined){var B=$(q).attr("title").indexOf("\uff1a");if(B!=-1){var p=$(q).attr("title").substring(0,B);if(s!=""){$(q).attr("title",p+"\uff1a"+s)}else{$(q).attr("title",p)}}else{if(s!=""){$(q).attr("title",$(q).attr("title")+"\uff1a"+s)}}}this.set_cell_value(parseInt(x.sheetindex)-1,D.x,D.y,y);if(z){crsReport.crsFormulasCache.execute_formulas(crsReport.get_valid_cur_task(),CRS_CHANGE_EXEC,0,t,C,"",false,false,false);crsReport.crsFormulasCache.execute_formulas(crsReport.get_valid_cur_task(),CRS_CHANGE_EXEC,0,t,C,"",true,false,false)}}},_get_sign_seal:function(f,d,e){if(e){return'<div class="websign" id="SIGN_POS_'+f+'" sign_check="'+d+'" onmouseenter="crsReport.crsCommon._id(this)"><div id="'+f+'_hw"></div><textarea                class="BigStatic Width70" wrap="yes" readonly style="vertical-align:middle;"></textarea>&nbsp;<input class="SmallButtonA" onclick="addSeal(\''+f+'\');" type="button" value="\u76d6\u7ae0">                <input class="SmallButtonA" onclick="handWrite(\''+f+'\',\'0x0000FF\');" type="button" value="\u624b\u5199"></div>'}else{return'<div class="websign" id="SIGN_POS_'+f+'" sign_check="'+d+'" onmouseenter="crsReport.crsCommon._id(this)"><div id="'+f+'_hw"></div><textarea                class="BigStatic Width90" wrap="yes" readonly style="vertical-align:middle;"></textarea></div>'}}};
