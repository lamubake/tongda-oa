function TCRSDataCache(d,f,e){this.crsDataSet=f;this.i_tab_id=e;this.s_cur_tab_name="crscell.crs_tabledata"+this.i_tab_id+crsReport.s_postfix;this.s_column_list="";this.s_cdef_column_list="";this.s_default_val="";this.arr_col_index=[];this.arr_col_index.push("displayseq");this.arr_col_index.push("title");this.arr_col_index.push("memo");this.obj_column_cache=d;this.obj_column_cache.get_column_list(this);this.s_cdef_column_list="create TABLE IF NOT EXISTS "+this.s_cur_tab_name+" (id int(10) unsigned NOT NULL auto_increment,kid varchar(40),organid int(11) unsigned NOT NULL default '1',userid varchar(20) NOT NULL default 'admin',writetime varchar(25) default '0000-00-00 00:00:00',uploadtime varchar(25) default '0000-00-00 00:00:00',logiccheck varchar(20) NOT NULL default 'unchecked',isfrozen char(2) NOT NULL default 'n',ismerge char(2) NOT NULL default 'n',rkid varchar(40),displayseq int(10),title varchar(255),memo tinytext,"+this.s_cdef_column_list+",PRIMARY KEY  (id),UNIQUE KEY id (id)) ENGINE=MyISAM;";this.s_default_val=";;"+crsReport.organId+";"+crsReport.userId+";"+crsReport.writeTime+";;uncheck;n;n;"+crsReport.refKID+";;;"+this.s_default_val;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_tabledata"+this.i_tab_id,"id;kid;organid;userid;writetime;uploadtime;logiccheck;isfrozen;ismerge;rkid;displayseq;title;memo;"+this.s_column_list,"userid='"+crsReport.userId+"' and writetime = '"+crsReport.writeTime+"'","position");this.obj_cur_rows=null}TCRSDataCache.prototype=new TCRSDataRecord();TCRSDataCache.prototype.LoadNomarizedData=function(){if(this.doLoaded){return}if(this.isEmpty()){if(crsReport.openMode=="write"){this.doLoaded=true;return}var x=crsReport.s_read_filter;if(x!==""){x=x.replaceAll("and","&");var u=x.split("&");x="";for(var K=0,M=u.length;K<M;K++){var A=u[K].replaceAll("or","|");var w=A.split("|");var J=0,y=w.length;var N="";while(J<y){var D=w[J].indexOf("crscell.crs_tabledata"+this.i_tab_id+"c");if(D!=-1){var v=w[J].indexOf(".",D+8);A=w[J].substring(D,v+1);w[K]=w[J].replaceAll(A,"");if(N!=""){N+=" or "}N+=w[K]}else{}J++}if(N!=""){if(x!=""){x+=" and "}x+="("+N+")"}}}var G=this.obj_column_cache.get_group_column_list();if(G==""){G=this.obj_column_cache.get_order_column_list()}if(G==""){G="displayseq"}if(x!=""){var z=x+" and userid='"+crsReport.userId+"' and writetime='"+crsReport.writeTime+"'"}else{var z="userid='"+crsReport.userId+"' and writetime='"+crsReport.writeTime+"'"}if(crsReport.refKID!=""){z+=" and rkid='"+crsReport.refKID+"'"}this.crsDataSet.execQuery2("select "+this.columnList.replaceAll(";",",")+" from "+this.tabName+" where "+z+" order by "+G,this.LoadNomarizedDataCB,this);if(this.isEmpty()){if(crsReport.s_data_flow==""){crsReport.s_data_flow=crsReport.crsReportState.get_data_flow(crsReport.s_cur_task)}var T=crsReport.s_data_flow;if(T!=""&&T.indexOf("->"+this.i_tab_id+"_{")){var H=T.split("%");for(var O=0,I=H.length;O<I;O++){if(H[O].indexOf("->"+this.i_tab_id+"_{")!=-1){break}}if(O<I){var B=H[O].split(";");for(var O=0,I=B.length;O<I;O++){var E=B[O].split(",");for(var R=0,S=E.length;R<S;R++){var U=E[R].indexOf("->");var A=E[R].indexOf("{",U),C=E[R].indexOf("}",U);var P=E[R].substr(0,U);var Q=E[R].substring(A,C+1);var L=crsReport.crsTableIndex.getAColSchema(Q);if(L!=null){if(R==0){if(crsReport.crsTableIndex.rows[L.row_idx].tabletype=="\u660e\u7ec6\u8868"||this.rows.length==0){var F=crsReport.crsTableIndex.create_row_kid(Q);this.rows.push(this.s_default_val.split(";"))}}this.rows[this.rows.length-1][this.arr_column_list.indexOf("col"+L.col.rows[L.col_idx].id)]=P}}}}}}}};TCRSDataCache.prototype.LoadNomarizedDataCB=function(j,i){i.doLoaded=true;if(j!=""){var k=j.split("\r");if(i.obj_column_cache.arr_group_column!=null&&crsReport.openMode=="read"){}for(var l=0,h=k.length;l<h;l++){k[l]=k[l].replaceAll('"',"\u53cc\u5f15\u53f7");k[l]=k[l].split(";");if(k[l][11]=="null"){k[l][11]=""}if(k[l][12]=="null"){k[l][12]=""}var g=new TCRSRowProperty(i.obj_column_cache,k[l][10],k[l][2],k[l][3],k[l][4],k[l][11],k[l][12]);crsReport.crsTableIndex.update_row_kid(k[l][1],g);if(crsReport.s_title!=HandleMemoStr(k[l][11],false)){crsReport.s_title=HandleMemoStr(k[l][11],false)}if(crsReport.s_memo!=HandleMemoStr(k[l][12],false)){crsReport.s_memo=HandleMemoStr(k[l][11],false)}}i.rows=k;if(i.obj_column_cache.i_init_cz!=k.length){i.obj_column_cache.i_init_cz=k.length}}};TCRSDataCache.prototype.get_record_count=function(){this.LoadNomarizedData();return this.rows.length};TCRSDataCache.prototype.add_cur_col_val=function(k,j,m){if(this.obj_cur_rows==null){this.obj_cur_rows={}}var n="d"+k;if(this.obj_cur_rows[n]==undefined){this.obj_cur_rows[n]=new Array(this.arr_col_index.length);for(var l=0,h=this.arr_col_index.length;l<h;l++){this.obj_cur_rows[n][l]=""}}var i=this.arr_col_index.indexOf(j);this.obj_cur_rows[n][i]=m};TCRSDataCache.prototype.end_add_cur_col_val=function(){this.obj_cur_rows=null};TCRSDataCache.prototype.free=function(){};
