function TCRSCodeItem(a){this.crsDataSet=a;this.b_tree_clicked=false;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_codeitem","id, codeid, code, name, topcode","","codeid, code")}TCRSCodeItem.prototype=new TCRSDataRecord();function TCRSCodeIndex(a){this.crsDataSet=a;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_codeindex","id, istree, refertype, allowothervalue, isparentselect","","");this.arr_codeitem=new TCRSCodeItem(a);this.obj_select_cache={}}TCRSCodeIndex.prototype=new TCRSDataRecord();TCRSCodeIndex.prototype.get_value_by_display_text=function(c,a){this.loadData("#tablecrs_codeindex");this.arr_codeitem.loadData("#tablecrs_codeitem");var b=a;var d=a.indexOf(".");if(d!=-1){a=a.substr(0,d)}var e=this.arr_codeitem.multi_search(["codeid","name"],[c,a]);if(e!=null){b=e.code}return b};TCRSCodeIndex.prototype.get_display_text_by_value=function(d,c){if(d<=0){return c}this.loadData("#tablecrs_codeindex");this.arr_codeitem.loadData("#tablecrs_codeitem");var b=c;var f=this.arr_codeitem.multi_search(["codeid","code"],[d,c]);if(f!=null){var e=this.search("id",d);var a=HandleMemoStr(e.refertype,false);if(a=="only code"){b=f.code}else{if(a=="only name"){b=f.name}else{b=f.code+"."+f.name}}}return b};TCRSCodeIndex.prototype.get_select=function(b,l){this.loadData("#tablecrs_codeindex");this.arr_codeitem.loadData("#tablecrs_codeitem");if(this.obj_select_cache[b]!=undefined){if(typeof this.obj_select_cache[b]=="object"){return""}var o=this.obj_select_cache[b];o=o.replace(" selected>",">");var d=o.indexOf("<option value='"+l+"'>");if(d!=-1){o=o.replace("<option value='"+l+"'>","<option value='"+l+"' selected>")}return o}else{var k="";var m=this.search("id",b);var e=HandleMemoStr(m.refertype,false);if(m!=null){if(m.istree!="y"){k+="<option value=''></option>";if(m.allowothervalue=="y"){k+="<option value='<\u8f93\u5165...>'><\u8f93\u5165...></option>"}var h=false;if(!this.arr_codeitem.isEmpty()){var f=this.arr_codeitem.first();while(!this.arr_codeitem.EOF()){if(f.codeid==b){var j="";var g=HandleMemoStr(f.code,false);var a=HandleMemoStr(f.name,false);if(e=="only code"){j=g}else{if(e=="only name"){j=a}else{j=g+"."+a}}if(!h&&l==g){h=true}k+="<option value='"+g+"'"+((l==g)?" selected":"")+">"+j+"</option>"}f=this.arr_codeitem.next()}}if(m.allowothervalue=="y"&&!h&&l!=""){k+="<option value='"+l+"' selected>"+l+"</option>"}}else{}}if(k!=""){this.obj_select_cache[b]=k}return k}};TCRSCodeIndex.prototype.get_tree=function(w,r,q,d,t,h,b,s){if(s==undefined){s=crsReport.obj_target_cell}var j=false;if(d==1){if(this.obj_select_cache[w]!=undefined){var f=this.obj_select_cache[w].toString();var m=f.indexOf(".set_value('")+12;var a=f.indexOf("'",m);var e=f.substring(m,a);f=f.replaceAll(e,b);$("#id_select").html(f);$("#id_select").css("left",$(s).offset().left);$("#id_select").css("top",$(s).offset().top+$(s).height());$("#id_select").show();$(document).bind("click",function(){var c=(window.event.srcElement==undefined)?window.event.target:window.event.srcElement;if(c!=undefined&&$(c).parents("#id_select").length==0){$("#id_select").hide();crsReport.crsCodeIndex.b_tree_clicked=false;$(document).unbind("click")}else{if(c!=undefined&&c.tagName!=undefined){if(c.tagName.toLowerCase()!="div"){crsReport.crsCodeIndex.b_tree_clicked=true}}}});window.event.cancelBubble=true;return}else{var g=this.search("id",w);h=HandleMemoStr(g.refertype,false);this.obj_select_cache[w]=new TreeView();this.obj_select_cache[w].setImagePath("/static/modules/reportshop/selecttree/images/");this.obj_select_cache[w].add(d++,t,g.name,"",null);t=1;j=true}}if(!this.arr_codeitem.isEmpty()){var l=this.arr_codeitem.first();while(!this.arr_codeitem.EOF()){if(l.codeid==w&&l.topcode==q){var i="";var u=HandleMemoStr(l.code,false);var o=HandleMemoStr(l.name,false);if(h=="only code"){i=u}else{if(h=="only name"){i=o}else{i=u+"."+o}}this.obj_select_cache[w].add(d++,t,u+"."+o,"crsReport.crsCodeIndex.set_value('"+b+"', '"+u+"', '"+i+"')",null);var k=this.arr_codeitem.cursor;d=this.get_tree(w,r,l.id,d,d-1,h,b);this.arr_codeitem.cursor=k}l=this.arr_codeitem.next()}if(j){$("#id_select").html(this.obj_select_cache[w].toString());$("#id_select").css("left",$(s).offset().left);$("#id_select").css("top",$(s).offset().top+$(s).height());$("#id_select").show();$(document).bind("click",function(){var c=(window.event.srcElement==undefined)?window.event.target:window.event.srcElement;if(c!=undefined&&$(c).parents("#id_select").length==0){$("#id_select").hide();crsReport.crsCodeIndex.b_tree_clicked=false;$(document).unbind("click")}else{if(c!=undefined&&c.tagName!=undefined){if(c.tagName.toLowerCase()!="div"){crsReport.crsCodeIndex.b_tree_clicked=true}}}});window.event.cancelBubble=true}return d}};TCRSCodeIndex.prototype.set_value=function(b,a,c){$("#"+b).val(a);$("#"+b+"_text").val(c);$("#id_select").html("");$("#id_select").hide();$("#"+b).change()};TCRSCodeIndex.prototype.is_readonly=function(a){var b=this.search("id",a);return b.allowothervalue!="y"};
