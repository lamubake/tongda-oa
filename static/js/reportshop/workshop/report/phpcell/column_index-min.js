function TCRSColumnIndex(c,d){this.crsDataSet=c;this.i_tab_id=d;TCRSDataRecord.call(this,this.crsDataSet,"crscell.crs_columnindex","*","tableid='"+d+"'","cellspan");this.obj_data_cache=new TCRSDataCache(this,this.crsDataSet,this.i_tab_id);this.arr_group_column=null;this.arr_merge_column=null;this.b_do_create_cur_table=false;this.i_init_cz=1;this.arr_output_cols=[];this.arr_radio_group=null;this.arr_picture_cols=null;this.arr_hidden_cols=null}TCRSColumnIndex.prototype=new TCRSDataRecord();TCRSColumnIndex.prototype.getRecordCount=function(){return this.obj_data_cache.get_record_count()};TCRSColumnIndex.prototype.getColumnDefRect=function(f){this.loadData("#tablecrs_columnindex"+this.i_tab_id);var h=[{pg:"",x:-1,y:-1},{pg:"",x:-1,y:-1}];if(!this.isEmpty()){var g=this.first();while(!this.EOF()){var e=rectNameToIndex(g.cellspan);if(h[0].x==-1||h[0].x>e[0].x){h[0].x=e[0].x}if(h[0].y==-1||h[0].y>e[0].y){h[0].y=e[0].y}if(h[1].x<e[1].x){h[1].x=e[1].x}if(h[1].y<e[1].y){h[1].y=e[1].y}g=this.next()}}return rectIndexToName(h)};TCRSColumnIndex.prototype.hasColumn=function(c){res=false;this.loadData("#tablecrs_columnindex"+this.i_tab_id);for(var d=0;d<this.rows.length;d++){if(this.rows[d].kid==c){res=true;break}}return res};TCRSColumnIndex.prototype.getWriteCellList=function(m,i){this.loadData("#tablecrs_columnindex"+this.i_tab_id);var n=null;if(!this.isEmpty()){n=[];var j=this.first();while(!this.EOF()){n.push({i_cell_span:j.cellspan,arr_cell_rect:rectNameToIndex(j.cellspan)});var k=HandleMemoStr(j.displaystyle,false);if(k==""){if(j.datatype=="\u6570\u503c\u578b"){k="0"}else{if(j.datatype=="\u6570\u503c\u578b"){k="_($#,##0_) ($#,##0)"}else{if(j.datatype=="\u65e5\u671f\u578b"){k="yyyy.mm.dd"}}}}n.push(k);n.push(m.sheetindex);if(m.tabletype=="\u4ea4\u53c9\u8868"){n.push("\u4e3b\u8868")}else{n.push(m.tabletype)}n.push(m.expandtype);var l=this.getRecordCount();if(l<m.initcz){l=m.initcz}n.push(l);n.push(j.datatype);n.push(j.defaultval);if(j.ishidden!="\u662f"&&m.ishidden=="\u662f"){j.ishidden="\u662f"}n.push(j.ishidden);n.push(j.readonly);var h=true;if(i!=null){if(indexOf(i,j.kid)==-1){h=false}}n.push(h);n.push(j.refrepid);n.push(j.color);n.push(j.kid);n.push(j.id);j=this.next()}}return n};TCRSColumnIndex.prototype.get_id_by_name=function(d){var c=this.search("columnlabel",d);if(c!=null){return c.id}else{return -1}};TCRSColumnIndex.prototype.get_raw_value=function(g,f){var e="";var h=this.getRecordCount();if(h>=f){e=HandleMemoStr(this.obj_data_cache.rows[f-1][this.obj_data_cache.get_nth_by_col_name("col"+g)],false);if(e=="1899-12-30 00:00:00"){e="0000-00-00 00:00:00"}}return e};TCRSColumnIndex.prototype.get_cell_value=function(r,v,q,t,p){var o="",w="";var x=v;if(!q){r=this.get_id_by_name(r)}var s=this.search("id",r);if(s!=null){var n=rectNameToIndex(s.cellspan);var m={};m.x=n[0].x;m.y=n[0].y;if(v==0){v=1}if(v>1){if(t.expandtype=="\u4e0d\u6269\u5c55"||t.expandtype=="\u6309\u884c\u5411\u4e0b"){m.y+=(x-1)*(n[1].y-n[0].y+1)}else{m.x+=(x-1)*(n[1].x-n[0].x+1)}}var u=this.getRecordCount();if(crsReport.writeColList!=null&&crsReport.writeColList.indexOf(s.kid)==-1&&crsReport.readColList!=null&&crsReport.readColList.indexOf(s.kid)==-1){if(u>0&&u>=v){o=this.obj_data_cache.rows[v-1][this.obj_data_cache.get_nth_by_col_name("col"+s.id)]}}else{o=crsReport.crsCommon.get_cell_value(0,m.x,m.y,p);if(o==""&&u>0&&u>=v){o=this.obj_data_cache.rows[v-1][this.obj_data_cache.get_nth_by_col_name("col"+s.id)]}}if(o=="1899-12-30 00:00:00"){o="0000-00-00 00:00:00"}}return o};TCRSColumnIndex.prototype.get_cur_tab_name=function(){if(this.obj_data_cache==null){this.obj_data_cache=new TCRSDataCache(this,this.crsDataSet,this.i_tab_id)}return this.obj_data_cache.s_cur_tab_name};TCRSColumnIndex.prototype.get_column_list=function(f){this.loadData("#tablecrs_columnindex"+this.i_tab_id);var g,h,e;if(!this.isEmpty()){row=this.first();while(!this.EOF()){f.arr_col_index.push(row.kid);if(f.s_cdef_column_list!=""){f.s_cdef_column_list+=",";f.s_column_list+=";"}g=row.id;f.s_column_list+="col"+g;h=HandleMemoStr(row.displaystyle,false);row.displaystyle=h;if(row.datatype=="\u81ea\u589e\u578b"){f.s_cdef_column_list+="col"+g+" int"}else{if(row.datatype=="\u8d27\u5e01\u578b"){f.s_cdef_column_list+="col"+g+" decimal(12,2)"}else{if(row.datatype=="\u6570\u503c\u578b"){if(row.displaystyle=="0"||row.displaystyle=="#,##0"||row.displaystyle=="(#,##0_) (#,##0)"||row.displaystyle=="(#,##0_) [Red](#,##0)"||row.displaystyle==""){if(row.barcode!=""){f.s_cdef_column_list+="col"+g+" bigint"}else{f.s_cdef_column_list+="col"+g+" int"}}else{f.s_cdef_column_list+="col"+g+" double"}}else{if(row.datatype=="\u65e5\u671f\u578b"){if(row.displaystyle=="yyyy\u5e74mm\u6708dd\u65e5"||row.displaystyle=="yyyy\u5e74mm\u6708"||row.displaystyle=="yyyy\u5e74"||row.displaystyle=="yyyy.mm.dd"||row.displaystyle=="yyyy.mm"||row.displaystyle=="m/d/yy"||row.displaystyle=="dd/mm/yy"||row.displaystyle=="dd.mmmm.yy"||row.displaystyle=="d-mmm-y"||row.displaystyle=="d-mmm"||row.displaystyle=="mmmm-yy"||row.displaystyle==""){f.s_cdef_column_list+="col"+g+" date"}else{if(row.displaystyle=="m/d/yy h:mm"){f.s_cdef_column_list+="col"+g+" datetime"}else{f.s_cdef_column_list+="col"+g+" time"}}}else{f.s_cdef_column_list+="col"+g+" text"}}}}e=row.defaultval;if(e==""&&row.ismust!="\u662f"){if(row.datatype=="\u8d27\u5e01\u578b"||row.datatype=="\u6570\u503c\u578b"||row.datatype=="\u65e5\u671f\u578b"){e=0}}f.s_default_val+=";"+e;row=this.next()}}};TCRSColumnIndex.prototype.update_cell_refer=function(m,p,n,i){this.loadData("#tablecrs_columnindex"+this.i_tab_id);if(!this.isEmpty()){var k=this.first();while(!this.EOF()){var j=crsReport.crsTableIndex.getAColSchema(k.kid);var o=j.display_rect;if(i!="\u6309\u5217\u5411\u53f3"&&o[0].y>m[1].y){var l=m[1].y-m[0].y+1;if(p=="insert"){o[0].y+=(l)*n;o[1].y+=(l)*n}else{o[0].y-=(l)*n;o[1].y-=(l)*n}k.cellspan=rectIndexToName(o)}else{if(i=="\u6309\u5217\u5411\u53f3"&&o[0].x>m[1].x){var l=m[1].x-m[0].x;if(p=="insert"){o[0].x+=(l)*n;o[1].x+=(l)*n}else{o[0].x-=(l)*n;o[1].x-=(l)*n}k.cellspan=rectIndexToName(o)}}k=this.next()}}};TCRSColumnIndex.prototype.get_group_column_list=function(){this.loadData("#tablecrs_columnindex"+this.i_tab_id);var d=this.cursor;var e="";if(!this.isEmpty()){var f=this.first();while(!this.EOF()){if(f.isgroup=="\u662f"){if(this.arr_group_column==null){this.arr_group_column=[]}this.arr_group_column.push("col"+f.id);if(e!=""){e+=","}e+="col"+f.id+" asc"}else{if(f.mergetype!=""&&f.mergetype!="\u4e0d\u6c47\u603b"){if(this.arr_merge_column==null){this.arr_merge_column=[]}this.arr_merge_column.push("col"+f.id);this.arr_merge_column.push(f.mergetype)}}f=this.next()}}this.cursor=d;return e};TCRSColumnIndex.prototype.get_order_column_list=function(){this.loadData("#tablecrs_columnindex"+this.i_tab_id);var d=this.cursor;var e="";if(!this.isEmpty()){var f=this.first();while(!this.EOF()){if(f.ordertype!=""&&f.ordertype!="\u4e0d\u6392\u5e8f"){if(e!=""){e+=","}e+="col"+f.id+" "+((f.ordertype=="\u5347\u5e8f")?"asc":"desc")}f=this.next()}}this.cursor=d;return e};TCRSColumnIndex.prototype.prev_handle_data=function(){};TCRSColumnIndex.prototype.get_first_data_item=function(){var h=null;if(this.obj_data_cache!=null){if(!this.obj_data_cache.isEmpty()){h={};h.data=this.obj_data_cache.first()}}if(h!=null){if(!this.isEmpty()){var f=[];var g=this.first();while(!this.EOF()){var e=rectNameToIndex(g.cellspan);f.push(g.id);f.push(e[0].x);f.push(e[0].y);f.push(g.displaystyle);f.push(g.datatype);f.push(g.refrepid);f.push(g.kid);f.push(this.obj_data_cache.get_nth_by_col_name("col"+g.id));f.push(this.obj_data_cache.get_nth_by_col_name("kid"));f.push(g.color);f.push(g.cellspan);f.push(g.readonly);f.push(g.ishidden);f.push(g.merge_equal);if(g.datatype=="\u4ee3\u7801\u578b"&&g.codeid>0){f[f.length-1]=g.codeid}g=this.next()}h.schema=f}}return h};TCRSColumnIndex.prototype.get_next_data_item=function(){var b=null;if(this.obj_data_cache!=null){if(!this.obj_data_cache.isEmpty()){if(!this.obj_data_cache.EOF()){b=this.obj_data_cache.next()}}}return b};TCRSColumnIndex.prototype.clear_data_item=function(u,i){if(i==null||i.length<=0){return}if(this.obj_data_cache!=null){var y=this.obj_data_cache.get_record_count();if(y<u.initcz){y=u.initcz}if(y>0){var q=parseInt(u.sheetindex)-1;for(var w=0,v=i.length/2;w<v;w++){var z=this.search("columnlabel",i[w*2]);if(z!=null){var t=(i[w*2+1].charAt(0)=="-")?true:false;var x=parseInt(i[w*2+1]);if(x<0){x=-x}var j=rectNameToIndex(z.cellspan);if(u.tabletype=="\u660e\u7ec6\u8868"&&x>0){if(u.expandtype=="\u6309\u5217\u5411\u53f3"||u.expandtype=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){var s=j[1].x-j[0].x+1;j[0].x+=s*(x-1);j[1].x+=s*(x-1);crsReport.crsCommon.clear_cell(q,j[0].x,j[0].y)}else{var s=j[1].y-j[0].y+1;j[0].y+=s*(x-1);j[1].y+=s*(x-1);crsReport.crsCommon.clear_cell(q,j[0].x,j[0].y)}}else{if(u.expandtype=="\u6309\u5217\u5411\u53f3"||u.expandtype=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){var s=j[1].x-j[0].x+1}else{var s=j[1].y-j[0].y+1;for(var r=0;r<y;r++){crsReport.crsCommon.clear_cell(q,j[0].x,j[0].y+s*r)}if(u.expandtype=="\u6309\u884c\u5411\u4e0b"&&!t&&this.i_init_cz<y){if(crsReport.b_as_form){for(var r=y-1;r>=this.i_init_cz;r--){crsReport.crsCommon.crsForm.delete_record(u,q,j[0].x,j[0].y+s*r)}}else{for(var r=y-1;r>=this.i_init_cz;r--){var B=j[0].y+s*r;var A="row"+B+"column"+j[0].x;crsReport.crsCommon.crsTable.delete_record(undefined,crsReport.obj_cell_maps[q][A])}}y=this.i_init_cz}}}}}}}};TCRSColumnIndex.prototype.reset_cell_color=function(o,i){if(i==null||i.length<=0){return}if(this.obj_data_cache!=null){var s=this.obj_data_cache.get_record_count();if(s<o.initcz){s=o.initcz}if(s>0){var m=parseInt(o.sheetindex)-1;for(var q=0,p=i.length/2;q<p;q++){if(i[q*2].charAt(0)=="{"){var t=this.search("kid",i[q*2])}else{var t=this.search("id",i[q*2])}if(t!=null){var r=i[q*2+1];var j=rectNameToIndex(t.cellspan);if(o.tabletype=="\u660e\u7ec6\u8868"&&r>0){if(o.expandtype=="\u6309\u5217\u5411\u53f3"||o.expandtype=="\u4e0d\u6269\u5c55\uff08\u6309\u5217\u5411\u53f3\uff09"){var n=j[1].x-j[0].x+1;j[0].x+=n*(r-1);j[1].x+=n*(r-1)}else{var n=j[1].y-j[0].y+1;j[0].y+=n*(r-1);j[1].y+=n*(r-1)}}crsReport.crsCommon.set_cell_backgroud_color(m,j[0].x,j[0].y)}}}}};TCRSColumnIndex.prototype.get_noclear_and_defaultval_column_list=function(d){if(!this.isEmpty()){var c=this.first();while(!this.EOF()){if(c.iskeep=="\u662f"){if(d.arr_noclear==null){d.arr_noclear=[]}d.arr_noclear.push(c.cellspan)}if(c.defaultval!=""){if(d.arr_defaultval==null){d.arr_defaultval=[]}d.arr_defaultval.push(c.cellspan);d.arr_defaultval.push(c.defaultval)}c=this.next()}}};TCRSColumnIndex.prototype.auto_increment=function(o,p){if(!this.isEmpty()){var j=this.first();while(!this.EOF()){if(j.datatype=="\u81ea\u589e\u578b"){var l=rectNameToIndex(j.cellspan);if(p=="\u6309\u884c\u5411\u4e0b"||p=="\u4e0d\u6269\u5c55"){var k=l[1].y-l[0].y+1;var q="row"+l[0].y+"column"+l[0].x;var n=crsReport.obj_cell_maps[o][q];var r=1;while(n!=null&&$(n).attr("cid")==j.kid){crsReport.crsCommon.set_cell_value(n,r);var m=l[0].y+r*k;var q="row"+m+"column"+l[0].x;n=crsReport.obj_cell_maps[o][q];r++}}}j=this.next()}}};TCRSColumnIndex.prototype.free=function(){if(this.obj_data_cache!=null){this.obj_data_cache.free()}};
