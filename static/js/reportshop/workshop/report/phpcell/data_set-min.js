function TCRSDataSet(){this.xml=""}TCRSDataSet.prototype={constructor:TCRSDataSet,execQuery:function(aSQL,cb,obj,s_key,_s_temp_table_list,_s_snapshot_sql){if(_s_temp_table_list==undefined){_s_temp_table_list=""}if(_s_snapshot_sql==undefined){_s_snapshot_sql=""}if(crsReport.arr_schema!=null&&s_key!=undefined&&s_key!=""){if(crsReport.arr_schema[s_key]!=undefined){if(crsReport.b_crs_gz&&typeof crsReport.arr_schema[s_key]=="string"){crsReport.arr_schema[s_key]=crs_decode(crsReport.arr_schema[s_key]);crsReport.arr_schema[s_key]=eval(crsReport.arr_schema[s_key])}if(cb==undefined){return crsReport.arr_schema[s_key]}else{cb(crsReport.arr_schema[s_key],obj);return}}}if(cb==undefined){var s=$.ajax({url:"/general/reportshop/utils/exec_query.php",type:"post",data:{SQLQuery:crsReport.b_crs_gz?crs_encode(aSQL):MapKey(HandleMemoStr(aSQL)),json:"1",temp_table_list:_s_temp_table_list,snapshot_sql:crsReport.b_crs_gz?crs_encode(_s_snapshot_sql):MapKey(HandleMemoStr2(_s_snapshot_sql))},dataType:"json",async:false}).responseText;if(crsReport.b_crs_gz){s=eval(crs_decode(s))}return s}else{$.ajax({url:"/general/reportshop/utils/exec_query.php",type:"post",data:{SQLQuery:crsReport.b_crs_gz?crs_encode(aSQL):MapKey(HandleMemoStr(aSQL)),json:"1",snapshot_sql:crsReport.b_crs_gz?crs_encode(_s_snapshot_sql):MapKey(HandleMemoStr2(_s_snapshot_sql))},dataType:crsReport.b_crs_gz?"text":"json",success:function(json){if(crsReport.b_crs_gz){json=eval(crs_decode(json))}cb(json,obj)},error:function(request,strError){alert("\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u65b0\u52a0\u8f7d\u3002")},async:false})}},execQuery2:function(d,e,f){$.ajax({url:"/general/reportshop/utils/exec_query2.php",type:"post",data:{SQLQuery:crsReport.b_crs_gz?crs_encode(d):MapKey(HandleMemoStr(d)),json:"1"},dataType:"text",success:function(a){if(crsReport.b_crs_gz){a=crs_decode(a)}e(a,f)},error:function(a,b){alert("\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u65b0\u52a0\u8f7d\u3002")},async:false})},exec_sql_list:function(y,D,p,s,v,u,x,r,A,w,C,z,B){var q=JSON.stringify(D);if(y==""){y="\u6570\u636e\u6e90_TD_OA"}if(B==undefined){B=""}var t=false;if(!(crsReport.crsFormulasCache.s_exec_time==CRS_SAVE_EXEC2||crsReport.crsFormulasCache.s_exec_time==CRS_SAVE_EXEC||crsReport.crsFormulasCache.s_exec_time==CRS_DELETE_EXEC||crsReport.crsFormulasCache.b_for_validate)){t=true}$.ajax({url:"/general/reportshop/utils/db_action.php",type:"post",data:{database:(y),action:"exec1",action_map:crsReport.b_crs_gz?crs_encode(q):q,b_pivot:p,cur_table_list:v,column_ref_back:x,cond_sql_list:r,temp_table_list:z,snapshot_sql:crsReport.b_crs_gz?crs_encode(B):MapKey(HandleMemoStr2(B)),json:"1",cur_rep:crsReport.s_postfix},dataType:"text",beforeSend:function(){show_hint()},complete:function(){hide_hint()},success:function(a){if(crsReport.b_crs_gz){a=crs_decode(a)}A(a,w,C);crsReport.crsFormulasCache.end_execute()},error:function(a,b){crsReport.crsFormulasCache.end_execute();alert("\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u65b0\u52a0\u8f7d\u3002")},async:t})},execUpdate:function(b){b=b.replaceAll("\\","#005C`");$.ajax({url:"/general/reportshop/utils/batch_exec_query.php",type:"post",data:{SQLQuery:crsReport.b_crs_gz?crs_encode(b):MapKey(HandleMemoStr2(b)),json:"1"},dataType:"text",success:function(a){},error:function(d,a){alert("\u4fdd\u5b58\u51fa\u9519\uff1a"+a)},async:false})},get_next_autocode:function(c){var d=$.ajax({url:"/general/reportshop/design/report/console/autocode/autocode.php?action=generate&id="+c,type:"get",dataType:"text",async:false}).responseText;return d},roll_back:function(d,c){$.ajax({url:"/general/reportshop/design/report/console/autocode/autocode.php?id="+d+"action=rollback&code="+c,type:"get",dataType:"text",async:false})},is_exist_key:function(g,k,j,l){var i=false;var h=$.ajax({url:"/general/reportshop/utils/misc2.php",data:{action:"is_exists_key",tabid:g,key_where:k,userid:j,writetime:l,json:1},type:"post",dataType:"text",async:false}).responseText;i=h=="y";return i},get_now:function(){return $.ajax({url:"/general/reportshop/utils/misc.php?action=timestamp",type:"get",dataType:"text",async:false}).responseText},calculate:function(_arr_actions,cb,obj,_b_asyn,_b_save_excel){var s=_arr_actions.toString();$.ajax({url:"/general/reportshop/utils/js_action.php",data:{action:"calcu",actions:crsReport.b_crs_gz?crs_encode(s):s,cur_rep:crsReport.s_postfix},type:"post",dataType:crsReport.b_crs_gz?"text":"json",beforeSend:function(){show_hint()},complete:function(){hide_hint()},success:function(json){if(crsReport.b_crs_gz){json=eval(crs_decode(json))}cb(json,obj,_b_save_excel)},error:function(request,strError){},async:_b_asyn})},save_as_excel:function(b){$("iframe[name='actionFrame']",window.parent.document).attr("src","/general/reportshop/utils/js_action.php?action=save_as_excel&file_name="+b+"&cur_rep="+crsReport.s_postfix)},free_me:function(f){var h="";for(var j=0,g=crsReport.arr_upload_files.length;j<g;j++){if(crsReport.arr_upload_files[j]!=""){h+=crsReport.arr_upload_files[j]+","}}f="";if(crsReport.openMode=="edit"&&crsReport.b_saved&&crsReport.b_delete_fresh){f=crsReport.crsTableIndex.create_cur_table_data(true)}var i={SQLQuery:crsReport.b_crs_gz?crs_encode(f):MapKey(HandleMemoStr2(f)),cur_rep:crsReport.s_postfix,json:1,open_mode:crsReport.openMode,has_workflow:crsReport.has_workflow(),saved:(crsReport.b_saved?1:0)};i.rep_repid=crsReport.repId;i.rep_organid=crsReport.organId;i.rep_userid=crsReport.userId;i.rep_writetime=crsReport.writeTime;if(h!=""){i.upload_files=h}if(crsReport.b_saved&&i.has_workflow){if(!crsReport.b_submit&&crsReport.b_is_endtask&&crsReport.writeColList!=null&&crsReport.writeColList.length==0){crsReport.b_submit=true}i.task_IsSubmit=crsReport.b_submit;i.task_BeginWriter=crsReport.s_begin_writer;i.task_CurTask=crsReport.s_cur_task;i.task_CurOrgan=crsReport.s_writer_organid;i.task_CurWriter=crsReport.s_writer;i.task_NextTask=crsReport.s_next_task;i.task_RedirectTask=crsReport.s_only_redirect_task}return $.ajax({url:"/general/reportshop/utils/free_me.php",type:"post",data:i,dataType:"text",success:function(a){},error:function(a,b){},async:false}).responseText},open_hyperlink:function(f,g,i,h){var j=$.ajax({url:"/general/reportshop/utils/misc2.php",type:"post",data:{action:"open_hyperlink",repid:crsReport.repId,kid:f,seq:g,postfix:i,userid:crsReport.userId,writetime:crsReport.writeTime,json:1,snapshot_sql:crsReport.b_crs_gz?crs_encode(h):MapKey(HandleMemoStr2(h))},dataType:"text",success:function(a){},error:function(a,b){},async:false}).responseText;return j},get_user_by_id:function(b){var a=[];$.ajax({url:"/general/reportshop/utils/get_user_by_id.php",type:"post",data:{userid_list:b},dataType:"json",success:function(c){a=c},error:function(c,d){},async:false});return a},get_user_by_name:function(a){var b=[];var d=$.ajax({url:"/general/reportshop/utils/get_user_by_name.php",type:"post",data:{username_list:a},dataType:"json",success:function(c){b=c},error:function(c,e){},async:false}).responseText;return b},get_dept_by_id:function(b){var a=[];var d=$.ajax({url:"/general/reportshop/utils/get_dept_by_id.php",type:"post",data:{deptid_list:b},dataType:"json",success:function(c){a=c},error:function(c,e){},async:false}).responseText;return a},get_dept_by_name:function(a){var b=[];var d=$.ajax({url:"/general/reportshop/utils/get_dept_by_name.php",type:"post",data:{deptname_list:a},dataType:"json",success:function(c){b=c},error:function(c,e){},async:false}).responseText;return b}};
